


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ja-JP" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ja-JP" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>QAOA ランタイム &mdash; Qiskit Optimization 0.3.2 ドキュメント</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/jupyter-sphinx.css" type="text/css" />
  <link rel="stylesheet" href="../_static/thebelab.css" type="text/css" />
  <link rel="stylesheet" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
  <link rel="stylesheet" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
  <link rel="stylesheet" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
    <link rel="index" title="インデックス" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="Release Notes" href="../release_notes.html" />
    <link rel="prev" title="Qiskit Optimization での古典的最適化ソルバーとモデルの使用" href="11_using_classical_optimization_solvers_and_models.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://qiskit.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="../getting_started.html">Getting started</a>
          </li>

          <li>
            <a href="https://qiskit.org/documentation/optimization/tutorials/index.html" target="_blank">Tutorials</a>
          </li>

          <li>
            <a href="https://qiskit.org/documentation/partners/" target="_blank">Partners</a>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-orange-arrow">
                Applications
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://qiskit.org/documentation/machine-learning/">
                  <span class="dropdown-title">Machine learning</span>
                  <p>QSVM, VQC (Variational Quantum Classifier), and QGAN (Quantum Generative
                    Adversarial Network) algorithms.</p>
                </a>
                <a class="nav-dropdown-item" href="https://qiskit.org/documentation/nature/">
                  <span class="dropdown-title">Nature</span>
                  <p>Quantum applications in chemistry, physics, and biology.</p>
                </a>
                <a class="nav-dropdown-item" href="https://qiskit.org/documentation/finance/">
                  <span class="dropdown-title">Finance</span>
                  <p>Uncertainty components for stock/securities problems, Ising translators for
                    portfolio optimizations and data providers to source real or random data.</p>
                </a>
                <a class="nav-dropdown-item" href="https://qiskit.org/documentation/optimization/">
                  <span class="dropdown-title">Optimization</span>
                  <p>High-level optimization problems that are ready to
                    run on simulators and real quantum devices</p>
                </a>
              </div>
          </li>
          <li>
              <a href="https://qiskit.org/documentation/experiments/" target="_blank">Experiments</a>
          </li>
          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-orange-arrow">
                Resources
              </a>
              <div class="resources-dropdown-menu">
                <a class="doc-dropdown-option nav-dropdown-item" href="https://qiskit.slack.com">
                  <span class="dropdown-title">Slack support</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://qiskit.org/textbook">
                  <span class="dropdown-title">Qiskit Textbook</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://qiskit.org/events">
                  <span class="dropdown-title">Qiskit events</span>
                  <p></p>
                </a>
            </div>
          </li>
          <li>
            <a href="https://github.com/Qiskit/qiskit-optimization" target="_blank">Github</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>

  </div>
</div>


<body class="pytorch-body">

   

    

    <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="rst-current-version-label">Japanese</span>
    <span class="rst-versions-dropdown-icon"></span>
  </span>
  <div class="rst-other-versions">
    
    <dl>
      <dt>言語</dt>
      
        <dd><a class="version" href="/documentation/optimization/tutorials/12_qaoa_runtime.html">English</a></dd>
      
        <dd><a class="version" href="/documentation/optimization/locale/bn_BN/tutorials/12_qaoa_runtime.html">Bengali</a></dd>
      
        <dd><a class="version" href="/documentation/optimization/locale/ja_JP/tutorials/12_qaoa_runtime.html">Japanese</a></dd>
      
    </dl>
    
  </div>
  <script>
    jQuery('.version').click((evt) => {
      const hash = window.location.hash
      const complete_url = evt.target.href + hash
      window.location = complete_url
      evt.preventDefault()
    })
  </script>
</div>

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            

            
              
              
                <div class="version">
                  0.3.2
                </div>
              
            

            


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

            
          </div>

          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">はじめに</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apidocs/qiskit_optimization.html">API リファレンス</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">チュートリアル</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">リリースノート</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="../index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
          <li><a href="index.html">Optimizationのチュートリアル</a> &gt;</li>
        
      <li>QAOA ランタイム</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/12_qaoa_runtime.ipynb.txt" rel="nofollow"><img src="../_static/images/view-page-source-icon.svg"></a>
          
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>このページは <a class="reference external" href="https://github.com/Qiskit/qiskit-optimization/blob/stable/0.3/docs/tutorials/12_qaoa_runtime.ipynb">docs/tutorials/12_qaoa_runtime.ipynb</a> から生成されました。</p>
</div>
<section id="QAOA-ランタイム">
<h1>QAOA ランタイム<a class="headerlink" href="#QAOA-ランタイム" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>Qiskitランタイムは、プログラム全体をバックエンド側で実行できるようにする実行モデルです。ここでは、QiskitランタイムでQAOAアルゴリズムを実行する方法について説明します。この最初のバージョンのQAOAランタイムが利用できるようにする機能のいくつかについて説明します。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">IBMQ</span>

<span class="n">IBMQ</span><span class="o">.</span><span class="n">load_account</span><span class="p">()</span>

<span class="n">provider</span> <span class="o">=</span> <span class="n">IBMQ</span><span class="o">.</span><span class="n">get_provider</span><span class="p">(</span><span class="n">hub</span><span class="o">=</span><span class="s2">&quot;ibm-q&quot;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="事前ステップ">
<h2>事前ステップ<a class="headerlink" href="#事前ステップ" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>まず、プログラムをロードし、その引数を調べて、どの入力が期待されているかを確認します。また、戻り値型を調査して、何が返されるかを理解します。QAOAプログラムは、プロバイダーから次のように入手します。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">program_id</span> <span class="o">=</span> <span class="s2">&quot;qaoa&quot;</span>
<span class="n">qaoa_program</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">program</span><span class="p">(</span><span class="n">program_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>ランタイムへの引数は次のように取得されます。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Program name: </span><span class="si">{</span><span class="n">qaoa_program</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, Program id: </span><span class="si">{</span><span class="n">qaoa_program</span><span class="o">.</span><span class="n">program_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qaoa_program</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Program name: qaoa, Program id: qaoa
ParameterNamespace (Values):
| Name       | Value        | Type         | Required |     Description |
-------------------------------------------------------------------------
| reps       | None         | integer     | False    | The number of QAOA repetitions, i.e. the QAOA depth typically labeled p. This value defaults to 1. This is an integer. |
| initial_po | None         | [&#39;array&#39;, &#39;s| False    | Initial parameters of the ansatz. Can be an array or the string ``&#39;random&#39;`` to choose random initial parameters. The type must be numpy.ndarray or str. |
| use_initia | None         | boolean     | False    | A boolean flag that, if set to True (the default is False), runs a heuristic algorithm to permute the Paulis in the cost operator to better fit the coupling map and the swap strategy. This is only needed when the optimization problem is sparse and when using swap strategies to transpile. |
| use_pulse_ | None         | boolean     | False    | A boolean on whether or not to use a pulse-efficient transpilation. This flag is set to False by default. |
| measuremen | None         | boolean     | False    | Whether to apply measurement error mitigation in form of a tensored measurement fitter to the measurements. Defaults to False. |
| alpha      | None         | number      | False    | The fraction of top measurement samples to be used for the expectation value (CVaR expectation). Defaults to 1, i.e. using all samples to construct the expectation value. |
| shots      | None         | integer     | False    | The integer number of shots used for each circuit evaluation. Defaults to 1024. |
| operator   | None         | object      | True     | The cost Hamiltonian, consisting of Pauli I and Z operators, whose smallest eigenvalue we&#39;re trying to find. The type must be a PauliSumOp. |
| optimizer  | None         | object      | False    | The classical optimizer used to update the parameters in each iteration. Per default, SPSA with automatic calibration of the learning rate is used. The type must be a qiskit.algorithms.optimizers.Optimizer. |
| aux_operat | None         | array       | False    | A list of operators to be evaluated at the final, optimized state. This must be a List[PauliSumOp]. |
| optimizati | None         | integer     | False    | The optimization level to run if the swap strategies are not used. This value is 1 by default. This is an integer. |
| use_swap_s | None         | boolean     | False    | A boolean on whether or not to use swap strategies when transpiling. This flag is set to True by default. If this is False then the standard transpiler with the given optimization level will run. |
</pre></div></div>
</div>
<p>ここでは、以下で詳しく説明するさまざまな入力引数を確認します。</p>
<ul class="simple">
<li><p><strong>operator</strong> は、最小化したいコスト演算子を表すため、これまでで最も重要な引数です。QAOAの場合、これは <code class="docutils literal notranslate"><span class="pre">PauliSumOp</span></code> に対応します。問題の2つの決定変数の間に二次項があるたびに、最小化したい <code class="docutils literal notranslate"><span class="pre">PauliSumOp</span></code> に対応する <code class="docutils literal notranslate"><span class="pre">ZZ</span></code> 項があります。たとえば、演算子 <code class="docutils literal notranslate"><span class="pre">PauliSumOp.from_list([(&quot;ZIZ&quot;,</span> <span class="pre">1),</span> <span class="pre">(&quot;IZZ&quot;,</span> <span class="pre">-1),</span> <span class="pre">(&quot;ZZI&quot;,</span> <span class="pre">1)])</span></code> は、ひとつのエッジの重みが負である三角形の最大カット問題に対応する場合があります。</p></li>
<li><p><strong>optimizer</strong> は、閉ループの古典的な最適化で使用されるオプティマイザーを表します。これは、ハードウェアのノイズを処理するためにデフォルトで SPSA になります。</p></li>
<li><p><strong>reps</strong> この整数は、QAOAレイヤーの数です。</p></li>
<li><p><strong>initial_point</strong> は、 <span class="math notranslate nohighlight">\(\gamma\)</span> と <span class="math notranslate nohighlight">\(\beta\)</span> の初期値です。これは、 <span class="math notranslate nohighlight">\([\gamma_1, \beta_1, \gamma_2, \beta_2, ...]\)</span> の順序で指定されたリストです。したがって、このリストの長さは、QAOAの深さの2倍にする必要があります（つまり、 <code class="docutils literal notranslate"><span class="pre">reps</span></code> パラメーター）。</p></li>
<li><p><strong>shots</strong> は、各回路で収集するショット数です。</p></li>
<li><p><strong>alpha</strong> はCVaR最適化の <span class="math notranslate nohighlight">\(\alpha\)</span> です [1] 。 <span class="math notranslate nohighlight">\(\alpha\)</span> が1より小さい場合、最適化ではショットの最良の <span class="math notranslate nohighlight">\(\alpha\)</span> 部分のみが保持されます。つまり、これは <code class="docutils literal notranslate"><span class="pre">qiskit.opflow</span></code> にある <code class="docutils literal notranslate"><span class="pre">CVaRExpectation(alpha,</span> <span class="pre">PauliExpectation())</span></code> の使用に対応します。</p></li>
<li><p><strong>measurement_error_mitigation</strong> は、読み出しエラー軽減を使用するかどうかを決定します。 <code class="docutils literal notranslate"><span class="pre">True</span></code> の場合、これを使用するアルゴリズムは <code class="docutils literal notranslate"><span class="pre">TensoredMeasFitter</span></code> を使用します。</p></li>
<li><p><strong>use_swap_strategies</strong> が <code class="docutils literal notranslate"><span class="pre">True</span></code> の場合、QAOAプログラムは、QAOAの <code class="docutils literal notranslate"><span class="pre">ZZ</span></code> 演算子の可換性と、プログラムが実行されるバックエンドの結合マップを考慮した専用のスワップ戦略を使用して、QAOA回路をトランスパイルします。 このオプションがFalseの場合、QAOAプログラムはデフォルトで最適化レベル1の標準トランスパイラーになります。この最適化レベルは、 <strong>optimization_level</strong> 入力オプションを使用して選択できます。</p></li>
<li><p><strong>use_pulse_efficient</strong> が <code class="docutils literal notranslate"><span class="pre">True</span></code> に設定されている場合、パルス効率の高いトランスパイルが各QAOA反復で実行されます [2] 。これにより、2量子ビットのブロックが収集され、CartanのKAK分解が適用されて、回路の <code class="docutils literal notranslate"><span class="pre">RZXGate</span></code> 表現が取得されます。次に、スケーリングされた相互共振パルスが使用されます。 詳細については、以下の付録Aを参照してください。</p></li>
<li><p><strong>use_initial_mapping</strong> が <code class="docutils literal notranslate"><span class="pre">True</span></code> の場合、ヒューリスティックアルゴリズムが実行され、コスト演算子のパウリ演算子がデバイスの結合マップによりよく適合するように並べ替えられます。この順列は、 <code class="docutils literal notranslate"><span class="pre">use_swap_strategies</span></code> オプションが <code class="docutils literal notranslate"><span class="pre">True</span></code> に設定されている場合にのみ適用され、完全に接続されていない問題に対してのみ意味があります。</p></li>
<li><p><strong>optimization_level</strong> これは、スワップ戦略が使用されていない場合のQiskitトランスパイラーの最適化レベルです。 デフォルト値は1です。</p></li>
</ul>
<section id="参考文献">
<h3>参考文献<a class="headerlink" href="#参考文献" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>[1] P. Kl. Barkoutsos, G. Nannicini, A. Robert, I. Tavernelli, and S. Woerner, <em>Improving Variational Quantum Optimization using CVaR</em>, Quantum <strong>4</strong>, 256 (2020).</p>
<p>[2] N. Earnest, C. Tornow, and D. J. Egger, <em>Pulse-efficient circuit transpilation for quantum applications on cross-resonance-based hardware</em>, Phys. Rev. Research <strong>3</strong>, 043088 (2021).</p>
</section>
</section>
<section id="QAOAランタイムプログラムの実行">
<h2>QAOAランタイムプログラムの実行<a class="headerlink" href="#QAOAランタイムプログラムの実行" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>ここで、5量子ビットの例を使用してQAOAランタイムプログラムを使用する方法を示します。</p>
<p>ここでは、クラウド上でプログラムを直接呼び出す方法を示します。 ただし、Qiskit Optimization は、Qiskit Optimization ワークフローにシームレスに適合する <code class="docutils literal notranslate"><span class="pre">QAOAClient</span></code> を提供し、ローカル <code class="docutils literal notranslate"><span class="pre">QAOA</span></code> アルゴリズムの直接の代替として使用できます。 この <code class="docutils literal notranslate"><span class="pre">QAOAClient</span></code> については、このチュートリアルで以下で説明します。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">qiskit.opflow</span> <span class="kn">import</span> <span class="n">PauliSumOp</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">I</span>
<span class="kn">from</span> <span class="nn">qiskit.algorithms.optimizers</span> <span class="kn">import</span> <span class="n">SPSA</span>

<span class="c1"># Define the cost operator to run.</span>
<span class="n">op</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">Z</span> <span class="o">^</span> <span class="n">Z</span> <span class="o">^</span> <span class="n">I</span> <span class="o">^</span> <span class="n">I</span> <span class="o">^</span> <span class="n">I</span><span class="p">)</span>
    <span class="o">-</span> <span class="p">(</span><span class="n">I</span> <span class="o">^</span> <span class="n">I</span> <span class="o">^</span> <span class="n">Z</span> <span class="o">^</span> <span class="n">Z</span> <span class="o">^</span> <span class="n">I</span><span class="p">)</span>
    <span class="o">+</span> <span class="p">(</span><span class="n">I</span> <span class="o">^</span> <span class="n">I</span> <span class="o">^</span> <span class="n">Z</span> <span class="o">^</span> <span class="n">I</span> <span class="o">^</span> <span class="n">Z</span><span class="p">)</span>
    <span class="o">-</span> <span class="p">(</span><span class="n">Z</span> <span class="o">^</span> <span class="n">I</span> <span class="o">^</span> <span class="n">Z</span> <span class="o">^</span> <span class="n">I</span> <span class="o">^</span> <span class="n">I</span><span class="p">)</span>
    <span class="o">-</span> <span class="p">(</span><span class="n">I</span> <span class="o">^</span> <span class="n">Z</span> <span class="o">^</span> <span class="n">Z</span> <span class="o">^</span> <span class="n">I</span> <span class="o">^</span> <span class="n">I</span><span class="p">)</span>
    <span class="o">+</span> <span class="p">(</span><span class="n">I</span> <span class="o">^</span> <span class="n">Z</span> <span class="o">^</span> <span class="n">I</span> <span class="o">^</span> <span class="n">Z</span> <span class="o">^</span> <span class="n">I</span><span class="p">)</span>
    <span class="o">+</span> <span class="p">(</span><span class="n">I</span> <span class="o">^</span> <span class="n">I</span> <span class="o">^</span> <span class="n">I</span> <span class="o">^</span> <span class="n">Z</span> <span class="o">^</span> <span class="n">Z</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># SPSA helps deal with noisy environments.</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">SPSA</span><span class="p">(</span><span class="n">maxiter</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># We will run a depth two QAOA.</span>
<span class="n">reps</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># The initial point for the optimization, chosen at random.</span>
<span class="n">initial_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">reps</span><span class="p">)</span>

<span class="c1"># The backend that will run the programm.</span>
<span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;backend_name&quot;</span><span class="p">:</span> <span class="s2">&quot;ibmq_qasm_simulator&quot;</span><span class="p">}</span>

<span class="c1"># The inputs of the program as described above.</span>
<span class="n">runtime_inputs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="n">op</span><span class="p">,</span>
    <span class="s2">&quot;reps&quot;</span><span class="p">:</span> <span class="n">reps</span><span class="p">,</span>
    <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer</span><span class="p">,</span>
    <span class="s2">&quot;initial_point&quot;</span><span class="p">:</span> <span class="n">initial_point</span><span class="p">,</span>
    <span class="s2">&quot;shots&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="o">**</span><span class="mi">13</span><span class="p">,</span>
    <span class="c1"># Set to True when running on real backends to reduce circuit</span>
    <span class="c1"># depth by leveraging swap strategies. If False the</span>
    <span class="c1"># given optimization_level (default is 1) will be used.</span>
    <span class="s2">&quot;use_swap_strategies&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="c1"># Set to True when optimizing sparse problems.</span>
    <span class="s2">&quot;use_initial_mapping&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="c1"># Set to true when using echoed-cross-resonance hardware.</span>
    <span class="s2">&quot;use_pulse_efficient&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>ここで、プロバイダーを使用してプログラムを実行します。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">job</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="n">program_id</span><span class="o">=</span><span class="n">program_id</span><span class="p">,</span>
    <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
    <span class="n">inputs</span><span class="o">=</span><span class="n">runtime_inputs</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Job id: </span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bob status: </span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Job id: c6t07edkoh6fa69ud39g
Bob status: JobStatus.DONE
</pre></div></div>
</div>
<p>ジョブが正常に実行されると、ジョブから結果を取得できます。結果オブジェクトには、最適化に関する情報が含まれています。自己整合性のために、 <code class="docutils literal notranslate"><span class="pre">result[&quot;inputs&quot;]</span></code> からアクセスできるQAOAプログラムへの入力も含まれています。 <code class="docutils literal notranslate"><span class="pre">&quot;inputs&quot;</span></code> の下の値は、上記のキーを持つ辞書です。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>特に興味深いのは、各反復でハードウェアで測定されたエネルギーと、返された固有状態です。この例では、最小化したコスト演算子のエネルギーが最大カット問題のインスタンスに対応すると想定しています。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>


<span class="k">def</span> <span class="nf">op_adj_mat</span><span class="p">(</span><span class="n">op</span><span class="p">:</span> <span class="n">PauliSumOp</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Extract the adjacency matrix from the op.&quot;&quot;&quot;</span>
    <span class="n">adj_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">op</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">pauli</span><span class="p">,</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="n">op</span><span class="o">.</span><span class="n">primitive</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pauli</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;Z&quot;</span><span class="p">])</span>  <span class="c1"># index of Z</span>
        <span class="n">adj_mat</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">adj_mat</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">coeff</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">coeff</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">adj_mat</span>


<span class="k">def</span> <span class="nf">get_cost</span><span class="p">(</span><span class="n">bit_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">adj_mat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Return the cut value of the bit string.&quot;&quot;&quot;</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bit_str</span><span class="p">),</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">bit</span><span class="p">)</span> <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="n">bit_str</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">cost</span> <span class="o">+=</span> <span class="n">adj_mat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">cost</span>


<span class="k">def</span> <span class="nf">get_cut_distribution</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Extract the cut distribution from the result.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dict of cut value: probability.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">adj_mat</span> <span class="o">=</span> <span class="n">op_adj_mat</span><span class="p">(</span><span class="n">PauliSumOp</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;inputs&quot;</span><span class="p">][</span><span class="s2">&quot;operator&quot;</span><span class="p">]))</span>

    <span class="n">state_results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">bit_str</span><span class="p">,</span> <span class="n">amp</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;eigenstate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">state_results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">bit_str</span><span class="p">,</span> <span class="n">get_cost</span><span class="p">(</span><span class="n">bit_str</span><span class="p">,</span> <span class="n">adj_mat</span><span class="p">),</span> <span class="n">amp</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>

    <span class="n">vals</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">state_results</span><span class="p">:</span>
        <span class="n">vals</span><span class="p">[</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">cut_vals</span> <span class="o">=</span> <span class="n">get_cut_distribution</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;optimizer_history&quot;</span><span class="p">][</span><span class="s2">&quot;energy&quot;</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cut_vals</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="nb">list</span><span class="p">(</span><span class="n">cut_vals</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Energy evaluation number&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Energy&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Cut value&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;Probability&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_12_qaoa_runtime_16_1.png" src="../_images/tutorials_12_qaoa_runtime_16_1.png" />
</div>
</div>
</section>
<section id="Qiskit-optimization">
<h2>Qiskit optimization<a class="headerlink" href="#Qiskit-optimization" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>上記の機能は Qiskit-optimization に実装されており、 <code class="docutils literal notranslate"><span class="pre">runtime</span></code> モジュールを介してQAOAランタイムにアクセスできます。ここで、このモジュールを <code class="docutils literal notranslate"><span class="pre">QAOAClient</span></code> で使用する方法を示します。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qiskit_optimization.runtime</span> <span class="kn">import</span> <span class="n">QAOAClient</span>
<span class="kn">from</span> <span class="nn">qiskit_optimization.algorithms</span> <span class="kn">import</span> <span class="n">MinimumEigenOptimizer</span>
<span class="kn">from</span> <span class="nn">qiskit_optimization</span> <span class="kn">import</span> <span class="n">QuadraticProgram</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qubo</span> <span class="o">=</span> <span class="n">QuadraticProgram</span><span class="p">()</span>
<span class="n">qubo</span><span class="o">.</span><span class="n">binary_var</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">qubo</span><span class="o">.</span><span class="n">binary_var</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
<span class="n">qubo</span><span class="o">.</span><span class="n">binary_var</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>
<span class="n">qubo</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">linear</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">quadratic</span><span class="o">=</span><span class="p">{(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">):</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">):</span> <span class="mi">2</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qubo</span><span class="o">.</span><span class="n">export_as_lp_string</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
\ This file has been generated by DOcplex
\ ENCODING=ISO-8859-1
\Problem name: CPLEX

Minimize
 obj: x - 2 y + 3 z + [ 2 x*y - 2 x*z + 4 y*z ]/2
Subject To

Bounds
 0 &lt;= x &lt;= 1
 0 &lt;= y &lt;= 1
 0 &lt;= z &lt;= 1

Binaries
 x y z
End

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qaoa_mes</span> <span class="o">=</span> <span class="n">QAOAClient</span><span class="p">(</span>
    <span class="n">provider</span><span class="o">=</span><span class="n">provider</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">provider</span><span class="o">.</span><span class="n">get_backend</span><span class="p">(</span><span class="s2">&quot;ibmq_qasm_simulator&quot;</span><span class="p">),</span> <span class="n">reps</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span>
<span class="p">)</span>

<span class="n">qaoa</span> <span class="o">=</span> <span class="n">MinimumEigenOptimizer</span><span class="p">(</span><span class="n">qaoa_mes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qaoa</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">qubo</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
optimal function value: -2.0
optimal value: [0. 1. 0.]
status: SUCCESS
</pre></div></div>
</div>
</section>
<section id="付録A：パルス効率の高いトランスパイル">
<h2>付録A：パルス効率の高いトランスパイル<a class="headerlink" href="#付録A：パルス効率の高いトランスパイル" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>QAOAランタイム・プログラムは、単一量子ビット・パルスの数を最小限に抑え、IBM Quantum Systemsのエコー・クロス・レゾナンス・ゲートに適用可能なクロス・レゾナンス・スケーリング手法を利用する、パルス効率の高いトランスパイルを活用できます。完全を期すために、ここでは実装されているパスマネージャーを示します。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qiskit.transpiler</span> <span class="kn">import</span> <span class="n">PassManager</span>
<span class="kn">from</span> <span class="nn">qiskit.circuit.library.standard_gates.equivalence_library</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">StandardEquivalenceLibrary</span> <span class="k">as</span> <span class="n">std_eqlib</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">qiskit.transpiler.passes</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Collect2qBlocks</span><span class="p">,</span>
    <span class="n">ConsolidateBlocks</span><span class="p">,</span>
    <span class="n">UnrollCustomDefinitions</span><span class="p">,</span>
    <span class="n">BasisTranslator</span><span class="p">,</span>
    <span class="n">Optimize1qGatesDecomposition</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">qiskit.transpiler.passes.calibration.builders</span> <span class="kn">import</span> <span class="n">RZXCalibrationBuilderNoEcho</span>
<span class="kn">from</span> <span class="nn">qiskit.transpiler.passes.optimization.echo_rzx_weyl_decomposition</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EchoRZXWeylDecomposition</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">qiskit.test.mock</span> <span class="kn">import</span> <span class="n">FakeBelem</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">backend</span> <span class="o">=</span> <span class="n">FakeBelem</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>パルス効率の高いパスは、qiskitのトランスパイラーパスを使用して実装されます。これには、KAK分解から取得した <code class="docutils literal notranslate"><span class="pre">RZXGate</span></code> に接続されたスケーリングされた相互共鳴ゲートへのパルス対応バックエンドの知識が必要です。 これらのスケーリングされたゲートは、キャリブレーションされたCNOTゲートのスケジュールに基づいています。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rzx_basis</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rzx&quot;</span><span class="p">,</span> <span class="s2">&quot;rz&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;sx&quot;</span><span class="p">]</span>

<span class="n">pulse_efficient</span> <span class="o">=</span> <span class="n">PassManager</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="c1"># Consolidate consecutive two-qubit operations.</span>
        <span class="n">Collect2qBlocks</span><span class="p">(),</span>
        <span class="n">ConsolidateBlocks</span><span class="p">(</span><span class="n">basis_gates</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;rz&quot;</span><span class="p">,</span> <span class="s2">&quot;sx&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;rxx&quot;</span><span class="p">]),</span>
        <span class="c1"># Rewrite circuit in terms of Weyl-decomposed echoed RZX gates.</span>
        <span class="n">EchoRZXWeylDecomposition</span><span class="p">(</span><span class="n">backend</span><span class="o">.</span><span class="n">defaults</span><span class="p">()</span><span class="o">.</span><span class="n">instruction_schedule_map</span><span class="p">),</span>
        <span class="c1"># Attach scaled CR pulse schedules to the RZX gates.</span>
        <span class="n">RZXCalibrationBuilderNoEcho</span><span class="p">(</span><span class="n">backend</span><span class="p">),</span>
        <span class="c1"># Simplify single-qubit gates.</span>
        <span class="n">UnrollCustomDefinitions</span><span class="p">(</span><span class="n">std_eqlib</span><span class="p">,</span> <span class="n">rzx_basis</span><span class="p">),</span>
        <span class="n">BasisTranslator</span><span class="p">(</span><span class="n">std_eqlib</span><span class="p">,</span> <span class="n">rzx_basis</span><span class="p">),</span>
        <span class="n">Optimize1qGatesDecomposition</span><span class="p">(</span><span class="n">rzx_basis</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>パスを示すために、2量子ビットゲートのブロックを使用して任意の回路を構築します。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">QuantumCircuit</span>

<span class="n">circ</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">h</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">circ</span><span class="o">.</span><span class="n">rzx</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">swap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">rx</span><span class="p">(</span><span class="mf">1.23</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s2">&quot;mpl&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_12_qaoa_runtime_28_0.png" src="../_images/tutorials_12_qaoa_runtime_28_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pulse_efficient</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s2">&quot;mpl&quot;</span><span class="p">,</span> <span class="n">fold</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_12_qaoa_runtime_29_0.png" src="../_images/tutorials_12_qaoa_runtime_29_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">qiskit.tools.jupyter</span>

<span class="o">%</span><span class="k">qiskit_version_table</span>
<span class="o">%</span><span class="k">qiskit_copyright</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<h3>Version Information</h3><table><tr><th>Qiskit Software</th><th>Version</th></tr><tr><td><code>qiskit-terra</code></td><td>0.20.0.dev0+d9ab98f</td></tr><tr><td><code>qiskit-aer</code></td><td>0.9.0</td></tr><tr><td><code>qiskit-ignis</code></td><td>0.6.0</td></tr><tr><td><code>qiskit-ibmq-provider</code></td><td>0.19.0.dev0+8f49a34</td></tr><tr><td><code>qiskit-aqua</code></td><td>0.9.5</td></tr><tr><td><code>qiskit</code></td><td>0.30.0</td></tr><tr><td><code>qiskit-nature</code></td><td>0.2.1</td></tr><tr><td><code>qiskit-optimization</code></td><td>0.3.0</td></tr><tr><th>System information</th></tr><tr><td>Python version</td><td>3.8.5</td></tr><tr><td>Python compiler</td><td>GCC 7.3.0</td></tr><tr><td>Python build</td><td>default, Sep  4 2020 07:30:14</td></tr><tr><td>OS</td><td>Linux</td></tr><tr><td>CPUs</td><td>4</td></tr><tr><td>Memory (Gb)</td><td>15.525527954101562</td></tr><tr><td colspan='2'>Wed Dec 15 16:05:03 2021 CET</td></tr></table></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div style='width: 100%; background-color:#d5d9e0;padding-left: 10px; padding-bottom: 10px; padding-right: 10px; padding-top: 5px'><h3>This code is a part of Qiskit</h3><p>&copy; Copyright IBM 2017, 2021.</p><p>This code is licensed under the Apache License, Version 2.0. You may<br>obtain a copy of this license in the LICENSE.txt file in the root directory<br> of this source tree or at http://www.apache.org/licenses/LICENSE-2.0.<p>Any modifications or derivative works of this code must retain this<br>copyright notice, and modified files need to carry a notice indicating<br>that they have been altered from the originals.</p></div></div>
</div>
</section>
</section>


             </article>
             
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../release_notes.html" class="btn btn-neutral float-right" title="Release Notes" accesskey="n" rel="next">Next <img src="../_static/images/chevron-right-orange.svg" class="next-page"></a>
      
      
        <a href="11_using_classical_optimization_solvers_and_models.html" class="btn btn-neutral" title="Qiskit Optimization での古典的最適化ソルバーとモデルの使用" accesskey="p" rel="prev"><img src="../_static/images/chevron-right-orange.svg" class="previous-page"> Previous</a>
      
    </div>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, 2021, Qiskit Optimization Development Team.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              <ul>
<li><a class="reference internal" href="#">QAOA ランタイム</a><ul>
<li><a class="reference internal" href="#事前ステップ">事前ステップ</a><ul>
<li><a class="reference internal" href="#参考文献">参考文献</a></li>
</ul>
</li>
<li><a class="reference internal" href="#QAOAランタイムプログラムの実行">QAOAランタイムプログラムの実行</a></li>
<li><a class="reference internal" href="#Qiskit-optimization">Qiskit optimization</a></li>
<li><a class="reference internal" href="#付録A：パルス効率の高いトランスパイル">付録A：パルス効率の高いトランスパイル</a></li>
</ul>
</li>
</ul>

            </div>
          </div>
        </div>
      </section>
    </div>

  

     
       <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
         <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
         <script src="../_static/jquery.js"></script>
         <script src="../_static/underscore.js"></script>
         <script src="../_static/doctools.js"></script>
         <script src="../_static/thebelab-helper.js"></script>
         <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
         <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
         <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
         <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
         <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
     

  

  <script type="text/javascript" src="../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


  <div>
    <br>
  </div>

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://qiskit.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="../getting_started.html">Getting Started</a>
          </li>
          <li>
            <a href="https://qiskit.org/documentation/optimization/tutorials/index.html" target="_blank">Tutorials</a>
          </li>
          <li>
            <a href="https://qiskit.org/documentation/partners/">Partners</a>
          </li>
          <br>
          <li class="resources-mobile-menu-title">
            Applications
          </li>
          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://qiskit.org/documentation/machine-learning/">Machine learning</a>
            </li>

            <li>
              <a href="https://qiskit.org/documentation/nature/">Nature</a>
            </li>

            <li>
              <a href="https://qiskit.org/documentation/finance/">Finance</a>
            </li>

            <li>
              <a href="https://qiskit.org/documentation/optimization/">Optimization</a>
            </li>
          </ul>
          <br>
          <li>
            <a href="https://qiskit.org/documentation/experiments/">Experiments</a>
          </li>
          <br>
          <li class="resources-mobile-menu-title">
            Resources
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://qiskit.slack.com">Slack support</a>
            </li>
          </ul>
          <br>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>