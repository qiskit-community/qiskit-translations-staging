


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="el-GR" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="el-GR" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>QPY serialization (qiskit.qpy) &mdash; Τεκμηρίωση του Qiskit - 0.37.0</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/jupyter-sphinx.css" type="text/css" />
  <link rel="stylesheet" href="../_static/thebelab.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme-override.css" type="text/css" />
  <link rel="stylesheet" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
    <link rel="index" title="Δείκτης" href="../genindex.html" />
    <link rel="search" title="Αναζήτηση" href="../search.html" />
    <link rel="next" title="qiskit.qpy.load" href="../stubs/qiskit.qpy.load.html" />
    <link rel="prev" title="qiskit.qobj.PulseLibraryItem.to_dict" href="../stubs/qiskit.qobj.PulseLibraryItem.to_dict.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://qiskit.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="../getting_started.html">Getting started</a>
          </li>

          <li>
            <a href="../tutorials.html">Tutorials</a>
          </li>

          <li>
            <a href="https://qiskit.org/documentation/partners/" target="_blank">Partners</a>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-orange-arrow">
                Applications
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://qiskit.org/documentation/machine-learning/">
                  <span class="dropdown-title">Machine learning</span>
                  <p>QSVM, VQC (Variational Quantum Classifier), and QGAN (Quantum Generative
                    Adversarial Network) algorithms.</p>
                </a>
                <a class="nav-dropdown-item" href="https://qiskit.org/documentation/nature/">
                  <span class="dropdown-title">Nature</span>
                  <p>Quantum applications in chemistry, physics, and biology.</p>
                </a>
                <a class="nav-dropdown-item" href="https://qiskit.org/documentation/finance/">
                  <span class="dropdown-title">Finance</span>
                  <p>Uncertainty components for stock/securities problems, Ising translators for
                    portfolio optimizations and data providers to source real or random data.</p>
                </a>
                <a class="nav-dropdown-item" href="https://qiskit.org/documentation/optimization/">
                  <span class="dropdown-title">Optimization</span>
                  <p>High-level optimization problems that are ready to
                    run on simulators and real quantum devices</p>
                </a>
              </div>
          </li>
          <li>
              <a href="https://qiskit.org/documentation/experiments/" target="_blank">Experiments</a>
          </li>
          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-orange-arrow">
                Resources
              </a>
              <div class="resources-dropdown-menu">
                <a class="doc-dropdown-option nav-dropdown-item" href="https://qiskit.slack.com">
                  <span class="dropdown-title">Slack support</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://qiskit.org/textbook">
                  <span class="dropdown-title">Qiskit Textbook</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://qiskit.org/events">
                  <span class="dropdown-title">Qiskit events</span>
                  <p></p>
                </a>
            </div>
          </li>
          <li>
            <a href="https://github.com/Qiskit/" target="_blank">GitHub</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>

  </div>
</div>


<body class="pytorch-body">

   

    

    <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="rst-current-version-label">el_GR</span>
    <span class="rst-versions-dropdown-icon"></span>
  </span>
  <div class="rst-other-versions">
    
    <dl>
      <dt>Γλώσσες</dt>
      
        <dd><a class="version" href="/documentation/apidoc/qpy.html">English</a></dd>
      
        <dd><a class="version" href="/documentation/locale/bn_BN/apidoc/qpy.html">Bengali</a></dd>
      
        <dd><a class="version" href="/documentation/locale/fr_FR/apidoc/qpy.html">French</a></dd>
      
        <dd><a class="version" href="/documentation/locale/de_DE/apidoc/qpy.html">German</a></dd>
      
        <dd><a class="version" href="/documentation/locale/ja_JP/apidoc/qpy.html">Japanese</a></dd>
      
        <dd><a class="version" href="/documentation/locale/ko_KR/apidoc/qpy.html">Korean</a></dd>
      
        <dd><a class="version" href="/documentation/locale/pt_UN/apidoc/qpy.html">Portuguese</a></dd>
      
        <dd><a class="version" href="/documentation/locale/es_UN/apidoc/qpy.html">Spanish</a></dd>
      
        <dd><a class="version" href="/documentation/locale/ta_IN/apidoc/qpy.html">Tamil</a></dd>
      
    </dl>
    
    <dl>
      <dt>Previous Releases</dt>
      
        <dd><a class="version" href="/documentation/stable/0.19/index.html">0.19</a></dd>
      
        <dd><a class="version" href="/documentation/stable/0.24/index.html">0.24</a></dd>
      
        <dd><a class="version" href="/documentation/stable/0.25/index.html">0.25</a></dd>
      
        <dd><a class="version" href="/documentation/stable/0.26/index.html">0.26</a></dd>
      
        <dd><a class="version" href="/documentation/stable/0.27/index.html">0.27</a></dd>
      
        <dd><a class="version" href="/documentation/stable/0.28/index.html">0.28</a></dd>
      
        <dd><a class="version" href="/documentation/stable/0.29/index.html">0.29</a></dd>
      
        <dd><a class="version" href="/documentation/stable/0.30/index.html">0.30</a></dd>
      
        <dd><a class="version" href="/documentation/stable/0.31/index.html">0.31</a></dd>
      
        <dd><a class="version" href="/documentation/stable/0.32/index.html">0.32</a></dd>
      
        <dd><a class="version" href="/documentation/stable/0.33/index.html">0.33</a></dd>
      
        <dd><a class="version" href="/documentation/stable/0.34/index.html">0.34</a></dd>
      
        <dd><a class="version" href="/documentation/stable/0.35/index.html">0.35</a></dd>
      
        <dd><a class="version" href="/documentation/stable/0.36/index.html">0.36</a></dd>
      
    </dl>
  </div>
  <script>
    jQuery('.version').click((evt) => {
      const hash = window.location.hash
      const complete_url = evt.target.href + hash
      window.location = complete_url
      evt.preventDefault()
    })
  </script>
</div>

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            

            
              
              
            

            


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

            
          </div>

          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Documentation Homepage</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Πρόσοψη</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../qc_intro.html">Κβαντικός υπολογισμός με λίγα λόγια</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro_tutorial1.html">Εισαγωγή στο Qiskit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing_to_qiskit.html">Συνεισφορά στο Qiskit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Local Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Βιβλιοθήκες</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="circuit_library.html">Βιβλιοθήκη Κυκλωμάτων</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Παραπομπές API</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="terra.html">Qiskit Terra</a></li>
<li class="toctree-l1"><a class="reference internal" href="aer.html">Qiskit Aer</a></li>
<li class="toctree-l1"><a class="reference internal" href="ibmq-provider.html">Qiskit IBM Quantum Provider</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Αντιμετώπιση προβλημάτων</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://quantum-computing.ibm.com/lab/docs/iql/manage/errors">Κωδικοί σφαλμάτων του IBM Quantum API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="../index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
          <li><a href="terra.html">Qiskit Terra API Reference</a> &gt;</li>
        
      <li>QPY serialization (<code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit.qpy</span></code>)</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
            
            <a href="../_sources/apidoc/qpy.rst" rel="nofollow"><img src="../_static/images/view-page-source-icon.svg"></a>
          
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">
          
          <div class="rst-content style-external-links">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <span class="target" id="module-qiskit.qpy"><span id="qiskit-qpy"></span></span><div class="section" id="qpy-serialization-qiskit-qpy">
<h1>QPY serialization (<a class="reference internal" href="#module-qiskit.qpy" title="qiskit.qpy"><code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit.qpy</span></code></a>)<a class="headerlink" href="#qpy-serialization-qiskit-qpy" title="Permalink to this heading">¶</a></h1>
<div class="section" id="using-qpy">
<h2>Using QPY<a class="headerlink" href="#using-qpy" title="Permalink to this heading">¶</a></h2>
<p>Using QPY is defined to be straightforward and mirror the user API of the
serializers in Python’s standard library, <code class="docutils literal notranslate"><span class="pre">pickle</span></code> and <code class="docutils literal notranslate"><span class="pre">json</span></code>. There are
2 user facing functions: <code class="xref py py-func docutils literal notranslate"><span class="pre">qiskit.circuit.qpy_serialization.dump()</span></code> and
<code class="xref py py-func docutils literal notranslate"><span class="pre">qiskit.circuit.qpy_serialization.load()</span></code> which are used to dump QPY data
to a file object and load circuits from QPY data in a file object respectively.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qiskit.circuit</span> <span class="kn">import</span> <span class="n">QuantumCircuit</span>
<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">qpy</span>

<span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Bell&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;test&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
<span class="n">qc</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">qc</span><span class="o">.</span><span class="n">measure_all</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;bell.qpy&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
    <span class="n">qpy</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">fd</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;bell.qpy&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
    <span class="n">new_qc</span> <span class="o">=</span> <span class="n">qpy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fd</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="section" id="api-documentation">
<h3>API documentation<a class="headerlink" href="#api-documentation" title="Permalink to this heading">¶</a></h3>
<table class="autosummary longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="../stubs/qiskit.qpy.load.html#qiskit.qpy.load" title="qiskit.qpy.load"><code class="xref py py-obj docutils literal notranslate"><span class="pre">load</span></code></a>(file_obj[, metadata_deserializer])</p></td>
<td><p>Load a QPY binary file</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../stubs/qiskit.qpy.dump.html#qiskit.qpy.dump" title="qiskit.qpy.dump"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dump</span></code></a>(programs, file_obj[, metadata_serializer])</p></td>
<td><p>Write QPY binary data to a file</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="qpy-compatibility">
<h3>QPY Compatibility<a class="headerlink" href="#qpy-compatibility" title="Permalink to this heading">¶</a></h3>
<p>The QPY format is designed to be backwards compatible moving forward. This means
you should be able to load a QPY with any newer Qiskit version than the one
that generated it. However, loading a QPY file with an older Qiskit version is
not supported and may not work.</p>
<p>For example, if you generated a QPY file using qiskit-terra 0.18.1 you could
load that QPY file with qiskit-terra 0.19.0 and a hypothetical qiskit-terra
0.29.0. However, loading that QPY file with 0.18.0 is not supported and may not
work.</p>
</div>
</div>
<div class="section" id="qpy-format">
<span id="id1"></span><h2>QPY Format<a class="headerlink" href="#qpy-format" title="Permalink to this heading">¶</a></h2>
<p>The QPY serialization format is a portable cross-platform binary
serialization format for <a class="reference internal" href="../stubs/qiskit.circuit.QuantumCircuit.html#qiskit.circuit.QuantumCircuit" title="qiskit.circuit.QuantumCircuit"><code class="xref py py-class docutils literal notranslate"><span class="pre">QuantumCircuit</span></code></a> objects in Qiskit. The basic
file format is as follows:</p>
<p>A QPY file (or memory object) always starts with the following 7
byte UTF8 string: <code class="docutils literal notranslate"><span class="pre">QISKIT</span></code> which is immediately followed by the overall
file header. The contents of the file header as defined as a C struct are:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">qpy_version</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">qiskit_major_version</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">qiskit_minor_version</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">qiskit_patch_version</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">num_circuits</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>All values use network byte order <a class="footnote-reference brackets" href="#f1" id="id2">1</a> (big endian) for cross platform
compatibility.</p>
<p>The file header is immediately followed by the circuit payloads.
Each individual circuit is composed of the following parts:</p>
<p><code class="docutils literal notranslate"><span class="pre">HEADER</span> <span class="pre">|</span> <span class="pre">METADATA</span> <span class="pre">|</span> <span class="pre">REGISTERS</span> <span class="pre">|</span> <span class="pre">CUSTOM_DEFINITIONS</span> <span class="pre">|</span> <span class="pre">INSTRUCTIONS</span></code></p>
<p>There is a circuit payload for each circuit (where the total number is dictated
by <code class="docutils literal notranslate"><span class="pre">num_circuits</span></code> in the file header). There is no padding between the
circuits in the data.</p>
<div class="section" id="version-5">
<span id="qpy-version-5"></span><h3>Version 5<a class="headerlink" href="#version-5" title="Permalink to this heading">¶</a></h3>
<p>Version 5 changes from <a class="reference internal" href="#qpy-version-4"><span class="std std-ref">Version 4</span></a> by adding support for <code class="xref py py-class docutils literal notranslate"><span class="pre">ScheduleBlock</span></code>
and changing two payloads the INSTRUCTION metadata payload and the CUSTOM_INSTRUCTION block.
These now have new fields to better account for <a class="reference internal" href="../stubs/qiskit.circuit.ControlledGate.html#qiskit.circuit.ControlledGate" title="qiskit.circuit.ControlledGate"><code class="xref py py-class docutils literal notranslate"><span class="pre">ControlledGate</span></code></a> objects in a circuit.
In addition, new payload MAP_ITEM is defined to implement the <a class="reference internal" href="#qpy-mapping"><span class="std std-ref">MAPPING</span></a> block.</p>
<p>With the support of <code class="xref py py-class docutils literal notranslate"><span class="pre">ScheduleBlock</span></code>, now <a class="reference internal" href="../stubs/qiskit.circuit.QuantumCircuit.html#qiskit.circuit.QuantumCircuit" title="qiskit.circuit.QuantumCircuit"><code class="xref py py-class docutils literal notranslate"><span class="pre">QuantumCircuit</span></code></a> can be
serialized together with <a class="reference internal" href="../stubs/qiskit.circuit.QuantumCircuit.html#qiskit.circuit.QuantumCircuit.calibrations" title="qiskit.circuit.QuantumCircuit.calibrations"><code class="xref py py-attr docutils literal notranslate"><span class="pre">calibrations</span></code></a>, or
<a class="reference external" href="https://qiskit.org/documentation/tutorials/circuits_advanced/05_pulse_gates.html">Pulse Gates</a>.
In QPY version 5 and above, <a class="reference internal" href="#qpy-circuit-calibrations"><span class="std std-ref">CIRCUIT_CALIBRATIONS</span></a> payload is
packed after the <a class="reference internal" href="#qpy-instructions"><span class="std std-ref">INSTRUCTIONS</span></a> block.</p>
<p>In QPY version 5 and above,</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">type</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>immediately follows the file header block to represent the program type stored in the file.</p>
<ul class="simple">
<li><p>When <code class="docutils literal notranslate"><span class="pre">type==c</span></code>, <a class="reference internal" href="../stubs/qiskit.circuit.QuantumCircuit.html#qiskit.circuit.QuantumCircuit" title="qiskit.circuit.QuantumCircuit"><code class="xref py py-class docutils literal notranslate"><span class="pre">QuantumCircuit</span></code></a> payload follows</p></li>
<li><p>When <code class="docutils literal notranslate"><span class="pre">type==s</span></code>, <a class="reference internal" href="../stubs/qiskit.pulse.ScheduleBlock.html#qiskit.pulse.ScheduleBlock" title="qiskit.pulse.ScheduleBlock"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScheduleBlock</span></code></a> payload follows</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Σημείωση</p>
<p>Different programs cannot be packed together in the same file.
You must create different files for different program types.
Multiple objects with the same type can be saved in a single file.</p>
</div>
<div class="section" id="schedule-block">
<span id="qpy-schedule-block"></span><h4>SCHEDULE_BLOCK<a class="headerlink" href="#schedule-block" title="Permalink to this heading">¶</a></h4>
<p><a class="reference internal" href="../stubs/qiskit.pulse.ScheduleBlock.html#qiskit.pulse.ScheduleBlock" title="qiskit.pulse.ScheduleBlock"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScheduleBlock</span></code></a> is first supported in QPY Version 5. This allows
users to save pulse programs in the QPY binary format as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">pulse</span><span class="p">,</span> <span class="n">qpy</span>

<span class="k">with</span> <span class="n">pulse</span><span class="o">.</span><span class="n">build</span><span class="p">()</span> <span class="k">as</span> <span class="n">schedule</span><span class="p">:</span>
    <span class="n">pulse</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">pulse</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">(</span><span class="mi">160</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">pulse</span><span class="o">.</span><span class="n">DriveChannel</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;schedule.qpy&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
    <span class="n">qpy</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">fd</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;schedule.qpy&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
    <span class="n">new_qc</span> <span class="o">=</span> <span class="n">qpy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fd</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>Note that circuit and schedule block are serialized and deserialized through
the same QPY interface. Input data type is implicitly analyzed and
no extra option is required to save the schedule block.</p>
</div>
<div class="section" id="schedule-block-header">
<h4>SCHEDULE_BLOCK_HEADER<a class="headerlink" href="#schedule-block-header" title="Permalink to this heading">¶</a></h4>
<p><a class="reference internal" href="../stubs/qiskit.pulse.ScheduleBlock.html#qiskit.pulse.ScheduleBlock" title="qiskit.pulse.ScheduleBlock"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScheduleBlock</span></code></a> block starts with the following header:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">name_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">metadata_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">num_element</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>which is immediately followed by <code class="docutils literal notranslate"><span class="pre">name_size</span></code> utf8 bytes of schedule name and
<code class="docutils literal notranslate"><span class="pre">metadata_size</span></code> utf8 bytes of the JSON serialized metadata dictionary
attached to the schedule.</p>
<p>Then, alignment context of the schedule block starts with <code class="docutils literal notranslate"><span class="pre">char</span></code>
representing the supported context type followed by the <a class="reference internal" href="#qpy-sequence"><span class="std std-ref">SEQUENCE</span></a> block representing
the parameters associated with the alignment context <code class="xref py py-attr docutils literal notranslate"><span class="pre">AlignmentKind._context_params</span></code>.
The context type char is mapped to each alignment subclass as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">l</span></code>: <a class="reference internal" href="../stubs/qiskit.pulse.transforms.AlignLeft.html#qiskit.pulse.transforms.AlignLeft" title="qiskit.pulse.transforms.AlignLeft"><code class="xref py py-class docutils literal notranslate"><span class="pre">AlignLeft</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">r</span></code>: <a class="reference internal" href="../stubs/qiskit.pulse.transforms.AlignRight.html#qiskit.pulse.transforms.AlignRight" title="qiskit.pulse.transforms.AlignRight"><code class="xref py py-class docutils literal notranslate"><span class="pre">AlignRight</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">s</span></code>: <a class="reference internal" href="../stubs/qiskit.pulse.transforms.AlignSequential.html#qiskit.pulse.transforms.AlignSequential" title="qiskit.pulse.transforms.AlignSequential"><code class="xref py py-class docutils literal notranslate"><span class="pre">AlignSequential</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">e</span></code>: <a class="reference internal" href="../stubs/qiskit.pulse.transforms.AlignEquispaced.html#qiskit.pulse.transforms.AlignEquispaced" title="qiskit.pulse.transforms.AlignEquispaced"><code class="xref py py-class docutils literal notranslate"><span class="pre">AlignEquispaced</span></code></a></p></li>
</ul>
<p>Note that <a class="reference internal" href="../stubs/qiskit.pulse.transforms.AlignFunc.html#qiskit.pulse.transforms.AlignFunc" title="qiskit.pulse.transforms.AlignFunc"><code class="xref py py-class docutils literal notranslate"><span class="pre">AlignFunc</span></code></a> context is not supported becasue of the callback function
stored in the context parameters.</p>
<p>This alignment block is further followed by <code class="docutils literal notranslate"><span class="pre">num_element</span></code> length of block elements which may
consist of nested schedule blocks and schedule instructions.
Each schedule instruction starts with <code class="docutils literal notranslate"><span class="pre">char</span></code> representing the instruction type
followed by the <a class="reference internal" href="#qpy-sequence"><span class="std std-ref">SEQUENCE</span></a> block representing the instruction
<code class="xref py py-attr docutils literal notranslate"><span class="pre">operands</span></code>.
Note that the data structure of pulse <a class="reference internal" href="pulse.html#qiskit.pulse.instructions.Instruction" title="qiskit.pulse.instructions.Instruction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Instruction</span></code></a>
is unified so that instance can be uniquely determied by the class and a tuple of operands.
The mapping of type char to the instruction subclass is defined as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">a</span></code>: <a class="reference internal" href="../stubs/qiskit.pulse.instructions.Acquire.html#qiskit.pulse.instructions.Acquire" title="qiskit.pulse.instructions.Acquire"><code class="xref py py-class docutils literal notranslate"><span class="pre">Acquire</span></code></a> instruction</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">p</span></code>: <a class="reference internal" href="../stubs/qiskit.pulse.instructions.Play.html#qiskit.pulse.instructions.Play" title="qiskit.pulse.instructions.Play"><code class="xref py py-class docutils literal notranslate"><span class="pre">Play</span></code></a> instruction</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">d</span></code>: <a class="reference internal" href="../stubs/qiskit.pulse.instructions.Delay.html#qiskit.pulse.instructions.Delay" title="qiskit.pulse.instructions.Delay"><code class="xref py py-class docutils literal notranslate"><span class="pre">Delay</span></code></a> instruction</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">f</span></code>: <a class="reference internal" href="../stubs/qiskit.pulse.instructions.SetFrequency.html#qiskit.pulse.instructions.SetFrequency" title="qiskit.pulse.instructions.SetFrequency"><code class="xref py py-class docutils literal notranslate"><span class="pre">SetFrequency</span></code></a> instruction</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">g</span></code>: <a class="reference internal" href="../stubs/qiskit.pulse.instructions.ShiftFrequency.html#qiskit.pulse.instructions.ShiftFrequency" title="qiskit.pulse.instructions.ShiftFrequency"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShiftFrequency</span></code></a> instruction</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">q</span></code>: <a class="reference internal" href="../stubs/qiskit.pulse.instructions.SetPhase.html#qiskit.pulse.instructions.SetPhase" title="qiskit.pulse.instructions.SetPhase"><code class="xref py py-class docutils literal notranslate"><span class="pre">SetPhase</span></code></a> instruction</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">r</span></code>: <a class="reference internal" href="../stubs/qiskit.pulse.instructions.ShiftPhase.html#qiskit.pulse.instructions.ShiftPhase" title="qiskit.pulse.instructions.ShiftPhase"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShiftPhase</span></code></a> instruction</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">b</span></code>: <code class="xref py py-class docutils literal notranslate"><span class="pre">RelativeBarrier</span></code> instruction</p></li>
</ul>
<p>The operands of these instances can be serialized through the standard QPY value serialization
mechanism, however there are special object types that only appear in the schedule operands.
Since the operands are serialized as <a class="reference internal" href="#qpy-sequence"><span class="std std-ref">SEQUENCE</span></a>, each element must be packed with the
INSTRUCTION_PARAM pack struct, where each payload starts with a header block consists of
the char <code class="docutils literal notranslate"><span class="pre">type</span></code> and uint64_t <code class="docutils literal notranslate"><span class="pre">size</span></code>.
Special objects start with the following type key:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">c</span></code>: <a class="reference internal" href="pulse.html#qiskit.pulse.channels.Channel" title="qiskit.pulse.channels.Channel"><code class="xref py py-class docutils literal notranslate"><span class="pre">Channel</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">w</span></code>: <a class="reference internal" href="../stubs/qiskit.pulse.library.Waveform.html#qiskit.pulse.library.Waveform" title="qiskit.pulse.library.Waveform"><code class="xref py py-class docutils literal notranslate"><span class="pre">Waveform</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">s</span></code>: <a class="reference internal" href="../stubs/qiskit.pulse.library.SymbolicPulse.html#qiskit.pulse.library.SymbolicPulse" title="qiskit.pulse.library.SymbolicPulse"><code class="xref py py-class docutils literal notranslate"><span class="pre">SymbolicPulse</span></code></a></p></li>
</ul>
</div>
<div class="section" id="channel">
<span id="qpy-schedule-channel"></span><h4>CHANNEL<a class="headerlink" href="#channel" title="Permalink to this heading">¶</a></h4>
<p>Channel block starts with channel subtype <code class="docutils literal notranslate"><span class="pre">char</span></code> that maps an object data to
<a class="reference internal" href="pulse.html#qiskit.pulse.channels.Channel" title="qiskit.pulse.channels.Channel"><code class="xref py py-class docutils literal notranslate"><span class="pre">Channel</span></code></a> subclass. Mapping is defined as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">d</span></code>: <a class="reference internal" href="../stubs/qiskit.pulse.channels.DriveChannel.html#qiskit.pulse.channels.DriveChannel" title="qiskit.pulse.channels.DriveChannel"><code class="xref py py-class docutils literal notranslate"><span class="pre">DriveChannel</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">c</span></code>: <a class="reference internal" href="../stubs/qiskit.pulse.channels.ControlChannel.html#qiskit.pulse.channels.ControlChannel" title="qiskit.pulse.channels.ControlChannel"><code class="xref py py-class docutils literal notranslate"><span class="pre">ControlChannel</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">m</span></code>: <a class="reference internal" href="../stubs/qiskit.pulse.channels.MeasureChannel.html#qiskit.pulse.channels.MeasureChannel" title="qiskit.pulse.channels.MeasureChannel"><code class="xref py py-class docutils literal notranslate"><span class="pre">MeasureChannel</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">a</span></code>: <a class="reference internal" href="../stubs/qiskit.pulse.channels.AcquireChannel.html#qiskit.pulse.channels.AcquireChannel" title="qiskit.pulse.channels.AcquireChannel"><code class="xref py py-class docutils literal notranslate"><span class="pre">AcquireChannel</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">e</span></code>: <a class="reference internal" href="../stubs/qiskit.pulse.channels.MemorySlot.html#qiskit.pulse.channels.MemorySlot" title="qiskit.pulse.channels.MemorySlot"><code class="xref py py-class docutils literal notranslate"><span class="pre">MemorySlot</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">r</span></code>: <a class="reference internal" href="../stubs/qiskit.pulse.channels.RegisterSlot.html#qiskit.pulse.channels.RegisterSlot" title="qiskit.pulse.channels.RegisterSlot"><code class="xref py py-class docutils literal notranslate"><span class="pre">RegisterSlot</span></code></a></p></li>
</ul>
<p>The key is immediately followed by the channel index serialized as the INSTRUCTION_PARAM.</p>
</div>
<div class="section" id="waveform">
<span id="qpy-schedule-waveform"></span><h4>Waveform<a class="headerlink" href="#waveform" title="Permalink to this heading">¶</a></h4>
<p>Waveform block starts with WAVEFORM header:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">epsilon</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">data_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">_bool</span><span class="w"> </span><span class="n">amp_limited</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>which is followed by <code class="docutils literal notranslate"><span class="pre">data_size</span></code> bytes of complex <code class="docutils literal notranslate"><span class="pre">ndarray</span></code> binary generated by <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.save.html">numpy.save</a>.
This represents the complex IQ data points played on a quantum device.
<a class="reference internal" href="../stubs/qiskit.pulse.library.Waveform.html#qiskit.pulse.library.Waveform.name" title="qiskit.pulse.library.Waveform.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">name</span></code></a> is saved after the samples in the
INSTRUCTION_PARAM pack struct, which can be string or <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</div>
<div class="section" id="symbolicpulse">
<span id="qpy-schedule-symbolic-pulse"></span><h4>SymbolicPulse<a class="headerlink" href="#symbolicpulse" title="Permalink to this heading">¶</a></h4>
<p>SymbolicPulse block starts with SYMBOLIC_PULSE header:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">type_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">envelope_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">constraints_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">valid_amp_conditions_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">_bool</span><span class="w"> </span><span class="n">amp_limited</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>which is followed by <code class="docutils literal notranslate"><span class="pre">type_size</span></code> utf8 bytes of <a class="reference internal" href="../stubs/qiskit.pulse.library.SymbolicPulse.html#qiskit.pulse.library.SymbolicPulse.pulse_type" title="qiskit.pulse.library.SymbolicPulse.pulse_type"><code class="xref py py-attr docutils literal notranslate"><span class="pre">SymbolicPulse.pulse_type</span></code></a> string
that represents a class of waveform, such as «Gaussian» or «GaussianSquare».
Then, <code class="docutils literal notranslate"><span class="pre">envelope_size</span></code>, <code class="docutils literal notranslate"><span class="pre">constraints_size</span></code>, <code class="docutils literal notranslate"><span class="pre">valid_amp_conditions_size</span></code> utf8 bytes of
serialized symbolic expressions are generated for <a class="reference internal" href="../stubs/qiskit.pulse.library.SymbolicPulse.html#qiskit.pulse.library.SymbolicPulse.envelope" title="qiskit.pulse.library.SymbolicPulse.envelope"><code class="xref py py-attr docutils literal notranslate"><span class="pre">SymbolicPulse.envelope</span></code></a>,
<a class="reference internal" href="../stubs/qiskit.pulse.library.SymbolicPulse.html#qiskit.pulse.library.SymbolicPulse.constraints" title="qiskit.pulse.library.SymbolicPulse.constraints"><code class="xref py py-attr docutils literal notranslate"><span class="pre">SymbolicPulse.constraints</span></code></a>, and <a class="reference internal" href="../stubs/qiskit.pulse.library.SymbolicPulse.html#qiskit.pulse.library.SymbolicPulse.valid_amp_conditions" title="qiskit.pulse.library.SymbolicPulse.valid_amp_conditions"><code class="xref py py-attr docutils literal notranslate"><span class="pre">SymbolicPulse.valid_amp_conditions</span></code></a>, respectively.
Since string representation of these expressions are usually lengthy,
the expression binary is generated by the python <a class="reference external" href="https://docs.python.org/3/library/zlib.html">zlib</a> module with data compression.</p>
<p>To uniquely specify a pulse instance, we also need to store the associated parameters,
which consist of <code class="docutils literal notranslate"><span class="pre">duration</span></code> and the rest of parameters as a dictionary.
Dictionary parameters are first dumped in the <a class="reference internal" href="#qpy-mapping"><span class="std std-ref">MAPPING</span></a> form, and then <code class="docutils literal notranslate"><span class="pre">duration</span></code>
is dumped with the INSTRUCTION_PARAM pack struct.
Lastly, <a class="reference internal" href="../stubs/qiskit.pulse.library.SymbolicPulse.html#qiskit.pulse.library.SymbolicPulse.name" title="qiskit.pulse.library.SymbolicPulse.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">name</span></code></a> is saved also with the
INSTRUCTION_PARAM pack struct, which can be string or <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</div>
<div class="section" id="mapping">
<span id="qpy-mapping"></span><h4>MAPPING<a class="headerlink" href="#mapping" title="Permalink to this heading">¶</a></h4>
<p>The MAPPING is a representation for arbitrary mapping object. This is a fixed length
<a class="reference internal" href="#qpy-sequence"><span class="std std-ref">SEQUENCE</span></a> of key-value pair represented by the MAP_ITEM payload.</p>
<p>A MAP_ITEM starts with a header defined as:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">key_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">type</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>which is immediately followed by the <code class="docutils literal notranslate"><span class="pre">key_size</span></code> utf8 bytes representing
the dictionary key in string and <code class="docutils literal notranslate"><span class="pre">size</span></code> utf8 bytes of arbitrary object data of
QPY serializable <code class="docutils literal notranslate"><span class="pre">type</span></code>.</p>
</div>
<div class="section" id="circuit-calibrations">
<span id="qpy-circuit-calibrations"></span><h4>CIRCUIT_CALIBRATIONS<a class="headerlink" href="#circuit-calibrations" title="Permalink to this heading">¶</a></h4>
<p>The CIRCUIT_CALIBRATIONS block is a dictionary to define pulse calibrations of the custom
instruction set. This block starts with the following CALIBRATION header:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">num_cals</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>which is followed by the <code class="docutils literal notranslate"><span class="pre">num_cals</span></code> length of calibration entries, each starts with
the CALIBRATION_DEF header:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">name_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">num_qubits</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">num_params</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">type</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The calibration definition header is then followed by <code class="docutils literal notranslate"><span class="pre">name_size</span></code> utf8 bytes of
the gate name, <code class="docutils literal notranslate"><span class="pre">num_qubits</span></code> length of integers representing a sequence of qubits,
and <code class="docutils literal notranslate"><span class="pre">num_params</span></code> length of INSTRUCTION_PARAM payload for parameters
associated to the custom instruction.
The <code class="docutils literal notranslate"><span class="pre">type</span></code> indicates the class of pulse program which is either, in pricinple,
<a class="reference internal" href="../stubs/qiskit.pulse.ScheduleBlock.html#qiskit.pulse.ScheduleBlock" title="qiskit.pulse.ScheduleBlock"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScheduleBlock</span></code></a> or <a class="reference internal" href="../stubs/qiskit.pulse.Schedule.html#qiskit.pulse.Schedule" title="qiskit.pulse.Schedule"><code class="xref py py-class docutils literal notranslate"><span class="pre">Schedule</span></code></a>. As of QPY Version 5,
only <a class="reference internal" href="../stubs/qiskit.pulse.ScheduleBlock.html#qiskit.pulse.ScheduleBlock" title="qiskit.pulse.ScheduleBlock"><code class="xref py py-class docutils literal notranslate"><span class="pre">ScheduleBlock</span></code></a> payload is supported.
Finally, <a class="reference internal" href="#qpy-schedule-block"><span class="std std-ref">SCHEDULE_BLOCK</span></a> payload is packed for each CALIBRATION_DEF entry.</p>
</div>
<div class="section" id="instruction">
<h4>INSTRUCTION<a class="headerlink" href="#instruction" title="Permalink to this heading">¶</a></h4>
<p>The INSTRUCTION block was modified to add two new fields <code class="docutils literal notranslate"><span class="pre">num_ctrl_qubits</span></code> and <code class="docutils literal notranslate"><span class="pre">ctrl_state</span></code>
which are used to model the <a class="reference internal" href="../stubs/qiskit.circuit.ControlledGate.html#qiskit.circuit.ControlledGate.num_ctrl_qubits" title="qiskit.circuit.ControlledGate.num_ctrl_qubits"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ControlledGate.num_ctrl_qubits</span></code></a> and
<a class="reference internal" href="../stubs/qiskit.circuit.ControlledGate.html#qiskit.circuit.ControlledGate.ctrl_state" title="qiskit.circuit.ControlledGate.ctrl_state"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ControlledGate.ctrl_state</span></code></a> attributes. The new payload packed struct
format is:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">name_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">label_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">num_parameters</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_qargs</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_cargs</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">_Bool</span><span class="w"> </span><span class="n">has_conditional</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">conditional_reg_name_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">conditional_value</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_ctrl_qubits</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ctrl_state</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The rest of the instruction payload is the same. You can refer to
<a class="reference internal" href="#qpy-instructions"><span class="std std-ref">INSTRUCTIONS</span></a> for the details of the full payload.</p>
</div>
<div class="section" id="custom-instruction">
<h4>CUSTOM_INSTRUCTION<a class="headerlink" href="#custom-instruction" title="Permalink to this heading">¶</a></h4>
<p>The CUSTOM_INSTRUCTION block in QPY version 5 adds a new field
<code class="docutils literal notranslate"><span class="pre">base_gate_size</span></code> which is used to define the size of the
<a class="reference internal" href="../stubs/qiskit.circuit.Instruction.html#qiskit.circuit.Instruction" title="qiskit.circuit.Instruction"><code class="xref py py-class docutils literal notranslate"><span class="pre">qiskit.circuit.Instruction</span></code></a> object stored in the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">ControlledGate.base_gate</span></code> attribute for a custom
<a class="reference internal" href="../stubs/qiskit.circuit.ControlledGate.html#qiskit.circuit.ControlledGate" title="qiskit.circuit.ControlledGate"><code class="xref py py-class docutils literal notranslate"><span class="pre">ControlledGate</span></code></a> object. With this change the CUSTOM_INSTRUCTION
metadata block becomes:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">name_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">type</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_qubits</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_clbits</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">_Bool</span><span class="w"> </span><span class="n">custom_definition</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_ctrl_qubits</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ctrl_state</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">base_gate_size</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Immediately following the CUSTOM_INSTRUCTION struct is the utf8 encoded name
of size <code class="docutils literal notranslate"><span class="pre">name_size</span></code>.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">custom_definition</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> that means that the immediately following
<code class="docutils literal notranslate"><span class="pre">size</span></code> bytes contains a QPY circuit data which can be used for the custom
definition of that gate. If <code class="docutils literal notranslate"><span class="pre">custom_definition</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code> then the
instruction can be considered opaque (ie no definition). The <code class="docutils literal notranslate"><span class="pre">type</span></code> field
determines what type of object will get created with the custom definition.
If it’s <code class="docutils literal notranslate"><span class="pre">'g'</span></code> it will be a <a class="reference internal" href="../stubs/qiskit.circuit.Gate.html#qiskit.circuit.Gate" title="qiskit.circuit.Gate"><code class="xref py py-class docutils literal notranslate"><span class="pre">Gate</span></code></a> object, <code class="docutils literal notranslate"><span class="pre">'i'</span></code>
it will be a <a class="reference internal" href="../stubs/qiskit.circuit.Instruction.html#qiskit.circuit.Instruction" title="qiskit.circuit.Instruction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Instruction</span></code></a> object.</p>
<p>Following this the next <code class="docutils literal notranslate"><span class="pre">base_gate_size</span></code> bytes contain the <code class="docutils literal notranslate"><span class="pre">INSTRUCTION</span></code>
payload for the <code class="xref py py-attr docutils literal notranslate"><span class="pre">ControlledGate.base_gate</span></code>.</p>
<p>Additionally an addition value for <code class="docutils literal notranslate"><span class="pre">type</span></code> is added <code class="docutils literal notranslate"><span class="pre">'c'</span></code> which is used to
indicate the custom instruction is a custom <a class="reference internal" href="../stubs/qiskit.circuit.ControlledGate.html#qiskit.circuit.ControlledGate" title="qiskit.circuit.ControlledGate"><code class="xref py py-class docutils literal notranslate"><span class="pre">ControlledGate</span></code></a>.</p>
</div>
</div>
<div class="section" id="version-4">
<span id="qpy-version-4"></span><h3>Version 4<a class="headerlink" href="#version-4" title="Permalink to this heading">¶</a></h3>
<p>Version 4 is identical to <a class="reference internal" href="#qpy-version-3"><span class="std std-ref">Version 3</span></a> except that it adds 2 new type strings
to the INSTRUCTION_PARAM struct, <code class="docutils literal notranslate"><span class="pre">z</span></code> to represent <code class="docutils literal notranslate"><span class="pre">None</span></code> (which is encoded as
no data), <code class="docutils literal notranslate"><span class="pre">q</span></code> to represent a <a class="reference internal" href="../stubs/qiskit.circuit.QuantumCircuit.html#qiskit.circuit.QuantumCircuit" title="qiskit.circuit.QuantumCircuit"><code class="xref py py-class docutils literal notranslate"><span class="pre">QuantumCircuit</span></code></a> (which is encoded as
a QPY circuit), <code class="docutils literal notranslate"><span class="pre">r</span></code> to represent a <code class="docutils literal notranslate"><span class="pre">range</span></code> of integers (which is encoded as
a <a class="reference internal" href="#qpy-range-pack"><span class="std std-ref">RANGE</span></a>), and <code class="docutils literal notranslate"><span class="pre">t</span></code> to represent a <code class="docutils literal notranslate"><span class="pre">sequence</span></code> (which is encoded as
defined by <a class="reference internal" href="#qpy-sequence"><span class="std std-ref">SEQUENCE</span></a>). Additionally, version 4 changes the type of register
index mapping array from <code class="docutils literal notranslate"><span class="pre">uint32_t</span></code> to <code class="docutils literal notranslate"><span class="pre">int64_t</span></code>. If the values of any of the
array elements are negative they represent a register bit that is not present in the
circuit.</p>
<p>The <a class="reference internal" href="#qpy-registers"><span class="std std-ref">REGISTERS</span></a> header format has also been updated to</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">type</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">_Bool</span><span class="w"> </span><span class="n">standalone</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">name_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">_bool</span><span class="w"> </span><span class="n">in_circuit</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>which just adds the <code class="docutils literal notranslate"><span class="pre">in_circuit</span></code> field which represents whether the register is
part of the circuit or not.</p>
<div class="section" id="range">
<span id="qpy-range-pack"></span><h4>RANGE<a class="headerlink" href="#range" title="Permalink to this heading">¶</a></h4>
<p>A RANGE is a representation of a <code class="docutils literal notranslate"><span class="pre">range</span></code> object. It is defined as:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">start</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">stop</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">step</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="sequence">
<span id="qpy-sequence"></span><h4>SEQUENCE<a class="headerlink" href="#sequence" title="Permalink to this heading">¶</a></h4>
<p>A SEQUENCE is a reprentation of a arbitrary sequence object. As sequence are just fixed length
containers of arbitrary python objects their QPY can’t fully represent any sequence,
but as long as the contents in a sequence are other QPY serializable types for
the INSTRUCTION_PARAM payload the <code class="docutils literal notranslate"><span class="pre">sequence</span></code> object can be serialized.</p>
<p>A sequence instruction parameter starts with a header defined as:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>followed by <code class="docutils literal notranslate"><span class="pre">size</span></code> elements that are INSTRUCTION_PARAM payloads, where each of
these define an element in the sequence. The sequence object will be typecasted
into proper type, e.g. <code class="docutils literal notranslate"><span class="pre">tuple</span></code>, afterwards.</p>
</div>
</div>
<div class="section" id="version-3">
<span id="qpy-version-3"></span><h3>Version 3<a class="headerlink" href="#version-3" title="Permalink to this heading">¶</a></h3>
<p>Version 3 of the QPY format is identical to <a class="reference internal" href="#qpy-version-2"><span class="std std-ref">Version 2</span></a> except that it defines
a struct format to represent a <a class="reference internal" href="../stubs/qiskit.circuit.library.PauliEvolutionGate.html#qiskit.circuit.library.PauliEvolutionGate" title="qiskit.circuit.library.PauliEvolutionGate"><code class="xref py py-class docutils literal notranslate"><span class="pre">PauliEvolutionGate</span></code></a>
natively in QPY. To accomplish this the <a class="reference internal" href="#qpy-custom-definition"><span class="std std-ref">CUSTOM_DEFINITIONS</span></a> struct now supports
a new type value <code class="docutils literal notranslate"><span class="pre">'p'</span></code> to represent a <a class="reference internal" href="../stubs/qiskit.circuit.library.PauliEvolutionGate.html#qiskit.circuit.library.PauliEvolutionGate" title="qiskit.circuit.library.PauliEvolutionGate"><code class="xref py py-class docutils literal notranslate"><span class="pre">PauliEvolutionGate</span></code></a>.
Enties in the custom instructions tables have unique name generated that start with the
string <code class="docutils literal notranslate"><span class="pre">&quot;###PauliEvolutionGate_&quot;</span></code> followed by a uuid string. This gate name is reservered
in QPY and if you have a custom <a class="reference internal" href="../stubs/qiskit.circuit.Instruction.html#qiskit.circuit.Instruction" title="qiskit.circuit.Instruction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Instruction</span></code></a> object with a definition
set and that name prefix it will error. If it’s of type <code class="docutils literal notranslate"><span class="pre">'p'</span></code> the data payload is defined
as follows:</p>
<div class="section" id="pauli-evolution">
<span id="pauli-evo-qpy"></span><h4>PAULI_EVOLUTION<a class="headerlink" href="#pauli-evolution" title="Permalink to this heading">¶</a></h4>
<p>This represents the high level <a class="reference internal" href="../stubs/qiskit.circuit.library.PauliEvolutionGate.html#qiskit.circuit.library.PauliEvolutionGate" title="qiskit.circuit.library.PauliEvolutionGate"><code class="xref py py-class docutils literal notranslate"><span class="pre">PauliEvolutionGate</span></code></a></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">operator_count</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">_Bool</span><span class="w"> </span><span class="n">standalone_op</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">time_type</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">time_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">synthesis_size</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>This is immediately followed by <code class="docutils literal notranslate"><span class="pre">operator_count</span></code> elements defined by the <a class="reference internal" href="#qpy-pauli-sum-op"><span class="std std-ref">SPARSE_PAULI_OP_LIST_ELEM</span></a>
payload.  Following that we have <code class="docutils literal notranslate"><span class="pre">time_size</span></code> bytes representing the <code class="docutils literal notranslate"><span class="pre">time</span></code> attribute. If
<code class="docutils literal notranslate"><span class="pre">standalone_op</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> then there must only be a single operator. The
encoding of these bytes is determined by the value of <code class="docutils literal notranslate"><span class="pre">time_type</span></code>. Possible values of
<code class="docutils literal notranslate"><span class="pre">time_type</span></code> are <code class="docutils literal notranslate"><span class="pre">'f'</span></code>, <code class="docutils literal notranslate"><span class="pre">'p'</span></code>, and <code class="docutils literal notranslate"><span class="pre">'e'</span></code>. If <code class="docutils literal notranslate"><span class="pre">time_type</span></code> is <code class="docutils literal notranslate"><span class="pre">'f'</span></code> it’s a double,
<code class="docutils literal notranslate"><span class="pre">'p'</span></code> defines a <a class="reference internal" href="../stubs/qiskit.circuit.Parameter.html#qiskit.circuit.Parameter" title="qiskit.circuit.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a> object  which is represented by a
<a class="reference internal" href="#qpy-param-struct"><span class="std std-ref">PARAMETER</span></a>, <code class="docutils literal notranslate"><span class="pre">e</span></code> defines a <a class="reference internal" href="../stubs/qiskit.circuit.ParameterExpression.html#qiskit.circuit.ParameterExpression" title="qiskit.circuit.ParameterExpression"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParameterExpression</span></code></a> object
(that’s not a <a class="reference internal" href="../stubs/qiskit.circuit.Parameter.html#qiskit.circuit.Parameter" title="qiskit.circuit.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a>) which is represented by a <a class="reference internal" href="#qpy-param-expr"><span class="std std-ref">PARAMETER_EXPR</span></a>.
Following that is <code class="docutils literal notranslate"><span class="pre">synthesis_size</span></code> bytes which is a utf8 encoded json payload representing
the <a class="reference internal" href="../stubs/qiskit.synthesis.EvolutionSynthesis.html#qiskit.synthesis.EvolutionSynthesis" title="qiskit.synthesis.EvolutionSynthesis"><code class="xref py py-class docutils literal notranslate"><span class="pre">EvolutionSynthesis</span></code></a> class used by the gate.</p>
</div>
<div class="section" id="sparse-pauli-op-list-elem">
<span id="qpy-pauli-sum-op"></span><h4>SPARSE_PAULI_OP_LIST_ELEM<a class="headerlink" href="#sparse-pauli-op-list-elem" title="Permalink to this heading">¶</a></h4>
<p>This represents an instance of <a class="reference internal" href="../stubs/qiskit.opflow.primitive_ops.PauliSumOp.html#qiskit.opflow.primitive_ops.PauliSumOp" title="qiskit.opflow.primitive_ops.PauliSumOp"><code class="xref py py-class docutils literal notranslate"><span class="pre">PauliSumOp</span></code></a>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">pauli_op_size</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>which is immediately followed by <code class="docutils literal notranslate"><span class="pre">pauli_op_size</span></code> bytes which are .npy format <a class="footnote-reference brackets" href="#f2" id="id3">2</a>
data which represents the <a class="reference internal" href="../stubs/qiskit.quantum_info.SparsePauliOp.html#qiskit.quantum_info.SparsePauliOp" title="qiskit.quantum_info.SparsePauliOp"><code class="xref py py-class docutils literal notranslate"><span class="pre">SparsePauliOp</span></code></a>.</p>
<p>Version 3 of the QPY format also defines a struct format to represent a
<code class="xref py py-class docutils literal notranslate"><span class="pre">ParameterVectorElement</span></code> as a distinct subclass from
a <a class="reference internal" href="../stubs/qiskit.circuit.Parameter.html#qiskit.circuit.Parameter" title="qiskit.circuit.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a>. This adds a new parameter type char <code class="docutils literal notranslate"><span class="pre">'v'</span></code>
to represent a <code class="xref py py-class docutils literal notranslate"><span class="pre">ParameterVectorElement</span></code> which is now
supported as a type string value for an INSTRUCTION_PARAM. The payload for these
parameters are defined below as <a class="reference internal" href="#qpy-param-vector"><span class="std std-ref">PARAMETER_VECTOR_ELEMENT</span></a>.</p>
</div>
<div class="section" id="parameter-vector-element">
<span id="qpy-param-vector"></span><h4>PARAMETER_VECTOR_ELEMENT<a class="headerlink" href="#parameter-vector-element" title="Permalink to this heading">¶</a></h4>
<p>A PARAMETER_VECTOR_ELEMENT represents a <code class="xref py py-class docutils literal notranslate"><span class="pre">ParameterVectorElement</span></code>
object the data for a INSTRUCTION_PARAM. The contents of the PARAMETER_VECTOR_ELEMENT are
defined as:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">vector_name_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">vector_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">uuid</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">index</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>which is immediately followed by <code class="docutils literal notranslate"><span class="pre">vector_name_size</span></code> utf8 bytes representing
the parameter’s vector name.</p>
</div>
<div class="section" id="parameter-expr">
<span id="qpy-param-expr-v3"></span><h4>PARAMETER_EXPR<a class="headerlink" href="#parameter-expr" title="Permalink to this heading">¶</a></h4>
<p>Additionally, since QPY format version v3 distinguishes between a
<a class="reference internal" href="../stubs/qiskit.circuit.Parameter.html#qiskit.circuit.Parameter" title="qiskit.circuit.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a> and <code class="xref py py-class docutils literal notranslate"><span class="pre">ParameterVectorElement</span></code>
the payload for a <a class="reference internal" href="../stubs/qiskit.circuit.ParameterExpression.html#qiskit.circuit.ParameterExpression" title="qiskit.circuit.ParameterExpression"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParameterExpression</span></code></a> needs to be updated
to distinguish between the types. The following is the modified payload format
which is mostly identical to the format in Version 1 and <a class="reference internal" href="#qpy-version-2"><span class="std std-ref">Version 2</span></a> but just
modifies the <code class="docutils literal notranslate"><span class="pre">map_elements</span></code> struct to include a symbol type field.</p>
<p>A PARAMETER_EXPR represents a <a class="reference internal" href="../stubs/qiskit.circuit.ParameterExpression.html#qiskit.circuit.ParameterExpression" title="qiskit.circuit.ParameterExpression"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParameterExpression</span></code></a>
object that the data for an INSTRUCTION_PARAM. The contents of a PARAMETER_EXPR
are defined as:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">map_elements</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">expr_size</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Immediately following the header is <code class="docutils literal notranslate"><span class="pre">expr_size</span></code> bytes of utf8 data containing
the expression string, which is the sympy srepr of the expression for the
parameter expression. Following that is a symbol map which contains
<code class="docutils literal notranslate"><span class="pre">map_elements</span></code> elements with the format</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">symbol_type</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">type</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">symbol_type</span></code> key determines the payload type of the symbol representation
for the element. If it’s <code class="docutils literal notranslate"><span class="pre">p</span></code> it represents a <a class="reference internal" href="../stubs/qiskit.circuit.Parameter.html#qiskit.circuit.Parameter" title="qiskit.circuit.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a>
and if it’s <code class="docutils literal notranslate"><span class="pre">v</span></code> it represents a <code class="xref py py-class docutils literal notranslate"><span class="pre">ParameterVectorElement</span></code>.
The map element struct is immediately followed by the symbol map key payload, if
<code class="docutils literal notranslate"><span class="pre">symbol_type</span></code> is <code class="docutils literal notranslate"><span class="pre">p</span></code> then it is followed immediately by a <a class="reference internal" href="#qpy-param-struct"><span class="std std-ref">PARAMETER</span></a>
object (both the struct and utf8 name bytes) and if <code class="docutils literal notranslate"><span class="pre">symbol_type</span></code> is <code class="docutils literal notranslate"><span class="pre">v</span></code>
then the struct is imediately followed by <a class="reference internal" href="#qpy-param-vector"><span class="std std-ref">PARAMETER_VECTOR_ELEMENT</span></a> (both the struct
and utf8 name bytes). That is followed by <code class="docutils literal notranslate"><span class="pre">size</span></code> bytes for the
data of the symbol. The data format is dependent on the value of <code class="docutils literal notranslate"><span class="pre">type</span></code>. If
<code class="docutils literal notranslate"><span class="pre">type</span></code> is <code class="docutils literal notranslate"><span class="pre">p</span></code> then it represents a <a class="reference internal" href="../stubs/qiskit.circuit.Parameter.html#qiskit.circuit.Parameter" title="qiskit.circuit.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a> and
size will be 0, the value will just be the same as the key. Similarly if the
<code class="docutils literal notranslate"><span class="pre">type</span></code> is <code class="docutils literal notranslate"><span class="pre">v</span></code> then it represents a <code class="xref py py-class docutils literal notranslate"><span class="pre">ParameterVectorElement</span></code>
and size will be 0 as the value will just be the same as the key. If
<code class="docutils literal notranslate"><span class="pre">type</span></code> is <code class="docutils literal notranslate"><span class="pre">f</span></code> then it represents a double precision float. If <code class="docutils literal notranslate"><span class="pre">type</span></code> is
<code class="docutils literal notranslate"><span class="pre">c</span></code> it represents a double precision complex, which is represented by the
<a class="reference internal" href="#qpy-complex"><span class="std std-ref">COMPLEX</span></a>. Finally, if type is <code class="docutils literal notranslate"><span class="pre">i</span></code> it represents an integer which is an
<code class="docutils literal notranslate"><span class="pre">int64_t</span></code>.</p>
</div>
</div>
<div class="section" id="version-2">
<span id="qpy-version-2"></span><h3>Version 2<a class="headerlink" href="#version-2" title="Permalink to this heading">¶</a></h3>
<p>Version 2 of the QPY format is identical to version 1 except for the HEADER
section is slightly different. You can refer to the <a class="reference internal" href="#qpy-version-1"><span class="std std-ref">Version 1</span></a> section
for the details on the rest of the payload format.</p>
<div class="section" id="header">
<h4>HEADER<a class="headerlink" href="#header" title="Permalink to this heading">¶</a></h4>
<p>The contents of HEADER are defined as a C struct are:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">name_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">global_phase_type</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">global_phase_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_qubits</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_clbits</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">metadata_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_registers</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">num_instructions</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">num_custom_gates</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>This is immediately followed by <code class="docutils literal notranslate"><span class="pre">name_size</span></code> bytes of utf8 data for the name
of the circuit. Following this is immediately <code class="docutils literal notranslate"><span class="pre">global_phase_size</span></code> bytes
representing the global phase. The content of that data is dictated by the
value of <code class="docutils literal notranslate"><span class="pre">global_phase_type</span></code>. If it’s <code class="docutils literal notranslate"><span class="pre">'f'</span></code> the data is a float and is the
size of a <code class="docutils literal notranslate"><span class="pre">double</span></code>. If it’s <code class="docutils literal notranslate"><span class="pre">'p'</span></code> defines a <a class="reference internal" href="../stubs/qiskit.circuit.Parameter.html#qiskit.circuit.Parameter" title="qiskit.circuit.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a>
object  which is represented by a PARAM struct (see below), <code class="docutils literal notranslate"><span class="pre">e</span></code> defines a
<a class="reference internal" href="../stubs/qiskit.circuit.ParameterExpression.html#qiskit.circuit.ParameterExpression" title="qiskit.circuit.ParameterExpression"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParameterExpression</span></code></a> object (that’s not a
<a class="reference internal" href="../stubs/qiskit.circuit.Parameter.html#qiskit.circuit.Parameter" title="qiskit.circuit.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a>) which is represented by a PARAM_EXPR struct
(see below).</p>
</div>
</div>
<div class="section" id="version-1">
<span id="qpy-version-1"></span><h3>Version 1<a class="headerlink" href="#version-1" title="Permalink to this heading">¶</a></h3>
<div class="section" id="id4">
<h4>HEADER<a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h4>
<p>The contents of HEADER as defined as a C struct are:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">name_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">global_phase</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_qubits</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_clbits</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">metadata_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_registers</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">num_instructions</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">num_custom_gates</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>This is immediately followed by <code class="docutils literal notranslate"><span class="pre">name_size</span></code> bytes of utf8 data for the name
of the circuit.</p>
</div>
<div class="section" id="metadata">
<h4>METADATA<a class="headerlink" href="#metadata" title="Permalink to this heading">¶</a></h4>
<p>The METADATA field is a UTF8 encoded JSON string. After reading the HEADER
(which is a fixed size at the start of the QPY file) and the <code class="docutils literal notranslate"><span class="pre">name</span></code> string
you then read the <code class="docutils literal notranslate"><span class="pre">metadata_size</span></code> number of bytes and parse the JSON to get
the metadata for the circuit.</p>
</div>
<div class="section" id="registers">
<span id="qpy-registers"></span><h4>REGISTERS<a class="headerlink" href="#registers" title="Permalink to this heading">¶</a></h4>
<p>The contents of REGISTERS is a number of REGISTER object. If num_registers is
&gt; 0 then after reading METADATA you read that number of REGISTER structs defined
as:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">type</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">_Bool</span><span class="w"> </span><span class="n">standalone</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">name_size</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">type</span></code> can be <code class="docutils literal notranslate"><span class="pre">'q'</span></code> or <code class="docutils literal notranslate"><span class="pre">'c'</span></code>.</p>
<p>Immediately following the REGISTER struct is the utf8 encoded register name of
size <code class="docutils literal notranslate"><span class="pre">name_size</span></code>. After the <code class="docutils literal notranslate"><span class="pre">name</span></code> utf8 bytes there is then an array of
int64_t values of size <code class="docutils literal notranslate"><span class="pre">size</span></code> that contains a map of the register’s index to
the circuit’s qubit index. For example, array element 0’s value is the index
of the <code class="docutils literal notranslate"><span class="pre">register[0]</span></code>”s position in the containing circuit’s qubits list.</p>
<div class="admonition note">
<p class="admonition-title">Σημείωση</p>
<p>Prior to QPY <a class="reference internal" href="#qpy-version-4"><span class="std std-ref">Version 4</span></a> the type of array elements was uint32_t. This was changed
to enable negative values which represent bits in the array not present in the
circuit</p>
</div>
<p>The standalone boolean determines whether the register is constructed as a
standalone register that was added to the circuit or was created from existing
bits. A register is considered standalone if it has bits constructed solely
as part of it, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">qr</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">qr</span><span class="p">)</span>
</pre></div>
</div>
<p>the register <code class="docutils literal notranslate"><span class="pre">qr</span></code> would be a standalone register. While something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bits</span> <span class="o">=</span> <span class="p">[</span><span class="n">Qubit</span><span class="p">(),</span> <span class="n">Qubit</span><span class="p">()]</span>
<span class="n">qr</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="n">bits</span><span class="o">=</span><span class="n">bits</span><span class="p">)</span>
<span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">bits</span><span class="o">=</span><span class="n">bits</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">qr</span></code> would have <code class="docutils literal notranslate"><span class="pre">standalone</span></code> set to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</div>
<div class="section" id="custom-definitions">
<span id="qpy-custom-definition"></span><h4>CUSTOM_DEFINITIONS<a class="headerlink" href="#custom-definitions" title="Permalink to this heading">¶</a></h4>
<p>This section specifies custom definitions for any of the instructions in the circuit.</p>
<p>CUSTOM_DEFINITION_HEADER contents are defined as:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>If size is greater than 0 that means the circuit contains custom instruction(s).
Each custom instruction is defined with a CUSTOM_INSTRUCTION block defined as:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">name_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">type</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_qubits</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_clbits</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">_Bool</span><span class="w"> </span><span class="n">custom_definition</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Immediately following the CUSTOM_INSTRUCTION struct is the utf8 encoded name
of size <code class="docutils literal notranslate"><span class="pre">name_size</span></code>.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">custom_definition</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> that means that the immediately following
<code class="docutils literal notranslate"><span class="pre">size</span></code> bytes contains a QPY circuit data which can be used for the custom
definition of that gate. If <code class="docutils literal notranslate"><span class="pre">custom_definition</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code> then the
instruction can be considered opaque (ie no definition). The <code class="docutils literal notranslate"><span class="pre">type</span></code> field
determines what type of object will get created with the custom definition.
If it’s <code class="docutils literal notranslate"><span class="pre">'g'</span></code> it will be a <a class="reference internal" href="../stubs/qiskit.circuit.Gate.html#qiskit.circuit.Gate" title="qiskit.circuit.Gate"><code class="xref py py-class docutils literal notranslate"><span class="pre">Gate</span></code></a> object, <code class="docutils literal notranslate"><span class="pre">'i'</span></code>
it will be a <a class="reference internal" href="../stubs/qiskit.circuit.Instruction.html#qiskit.circuit.Instruction" title="qiskit.circuit.Instruction"><code class="xref py py-class docutils literal notranslate"><span class="pre">Instruction</span></code></a> object.</p>
</div>
<div class="section" id="instructions">
<span id="qpy-instructions"></span><h4>INSTRUCTIONS<a class="headerlink" href="#instructions" title="Permalink to this heading">¶</a></h4>
<p>The contents of INSTRUCTIONS is a list of INSTRUCTION metadata objects</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">name_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">label_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">num_parameters</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_qargs</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_cargs</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">_Bool</span><span class="w"> </span><span class="n">has_conditional</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">conditional_reg_name_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">conditional_value</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>This metadata object is immediately followed by <code class="docutils literal notranslate"><span class="pre">name_size</span></code> bytes of utf8 bytes
for the <code class="docutils literal notranslate"><span class="pre">name</span></code>. <code class="docutils literal notranslate"><span class="pre">name</span></code> here is the Qiskit class name for the Instruction
class if it’s defined in Qiskit. Otherwise it falls back to the custom
instruction name. Following the <code class="docutils literal notranslate"><span class="pre">name</span></code> bytes there are <code class="docutils literal notranslate"><span class="pre">label_size</span></code> bytes of
utf8 data for the label if one was set on the instruction. Following the label
bytes if <code class="docutils literal notranslate"><span class="pre">has_conditional</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> then there are
<code class="docutils literal notranslate"><span class="pre">conditional_reg_name_size</span></code> bytes of utf8 data for the name of the conditional
register name. In case of single classical bit conditions the register name
utf8 data will be prefixed with a null character «x00» and then a utf8 string
integer representing the classical bit index in the circuit that the condition
is on.</p>
<p>This is immediately followed by the INSTRUCTION_ARG structs for the list of
arguments of that instruction. These are in the order of all quantum arguments
(there are num_qargs of these) followed by all classical arguments (num_cargs
of these).</p>
<p>The contents of each INSTRUCTION_ARG is:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">type</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">index</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">type</span></code> can be <code class="docutils literal notranslate"><span class="pre">'q'</span></code> or <code class="docutils literal notranslate"><span class="pre">'c'</span></code>.</p>
<p>After all arguments for an instruction the parameters are specified with
<code class="docutils literal notranslate"><span class="pre">num_parameters</span></code> INSTRUCTION_PARAM structs.</p>
<p>The contents of each INSTRUCTION_PARAM is:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">type</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>After each INSTRUCTION_PARAM the next <code class="docutils literal notranslate"><span class="pre">size</span></code> bytes are the parameter’s data.
The <code class="docutils literal notranslate"><span class="pre">type</span></code> field can be <code class="docutils literal notranslate"><span class="pre">'i'</span></code>, <code class="docutils literal notranslate"><span class="pre">'f'</span></code>, <code class="docutils literal notranslate"><span class="pre">'p'</span></code>, <code class="docutils literal notranslate"><span class="pre">'e'</span></code>, <code class="docutils literal notranslate"><span class="pre">'s'</span></code>, <code class="docutils literal notranslate"><span class="pre">'c'</span></code>
or <code class="docutils literal notranslate"><span class="pre">'n'</span></code> which dictate the format. For <code class="docutils literal notranslate"><span class="pre">'i'</span></code> it’s an integer, <code class="docutils literal notranslate"><span class="pre">'f'</span></code> it’s
a double, <code class="docutils literal notranslate"><span class="pre">'s'</span></code> if it’s a string (encoded as utf8), <code class="docutils literal notranslate"><span class="pre">'c'</span></code> is a complex and
the data is represented by the struct format in the <a class="reference internal" href="#qpy-param-expr"><span class="std std-ref">PARAMETER_EXPR</span></a> section.
<code class="docutils literal notranslate"><span class="pre">'p'</span></code> defines a <a class="reference internal" href="../stubs/qiskit.circuit.Parameter.html#qiskit.circuit.Parameter" title="qiskit.circuit.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a> object  which is
represented by a <a class="reference internal" href="#qpy-param-struct"><span class="std std-ref">PARAMETER</span></a> struct, <code class="docutils literal notranslate"><span class="pre">e</span></code> defines a
<a class="reference internal" href="../stubs/qiskit.circuit.ParameterExpression.html#qiskit.circuit.ParameterExpression" title="qiskit.circuit.ParameterExpression"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParameterExpression</span></code></a> object (that’s not a
<a class="reference internal" href="../stubs/qiskit.circuit.Parameter.html#qiskit.circuit.Parameter" title="qiskit.circuit.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a>) which is represented by a <a class="reference internal" href="#qpy-param-expr"><span class="std std-ref">PARAMETER_EXPR</span></a>
struct (on QPY format <a class="reference internal" href="#qpy-version-3"><span class="std std-ref">Version 3</span></a> the format is tweak slightly see:
<a class="reference internal" href="#qpy-param-expr-v3"><span class="std std-ref">PARAMETER_EXPR</span></a>), <code class="docutils literal notranslate"><span class="pre">'n'</span></code> represents an object from numpy (either an
<code class="docutils literal notranslate"><span class="pre">ndarray</span></code> or a numpy type) which means the data is .npy format <a class="footnote-reference brackets" href="#f2" id="id5">2</a> data,
and in QPY <a class="reference internal" href="#qpy-version-3"><span class="std std-ref">Version 3</span></a> <code class="docutils literal notranslate"><span class="pre">'v'</span></code> represents a
<code class="xref py py-class docutils literal notranslate"><span class="pre">ParameterVectorElement</span></code> which is represented by a
<a class="reference internal" href="#qpy-param-vector"><span class="std std-ref">PARAMETER_VECTOR_ELEMENT</span></a> struct.</p>
</div>
<div class="section" id="parameter">
<span id="qpy-param-struct"></span><h4>PARAMETER<a class="headerlink" href="#parameter" title="Permalink to this heading">¶</a></h4>
<p>A PARAMETER represents a <a class="reference internal" href="../stubs/qiskit.circuit.Parameter.html#qiskit.circuit.Parameter" title="qiskit.circuit.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a> object the data for
a INSTRUCTION_PARAM. The contents of the PARAMETER are defined as:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">name_size</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">uuid</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>which is immediately followed by <code class="docutils literal notranslate"><span class="pre">name_size</span></code> utf8 bytes representing the
parameter name.</p>
</div>
<div class="section" id="qpy-param-expr">
<span id="id6"></span><h4>PARAMETER_EXPR<a class="headerlink" href="#qpy-param-expr" title="Permalink to this heading">¶</a></h4>
<p>A PARAMETER_EXPR represents a <a class="reference internal" href="../stubs/qiskit.circuit.ParameterExpression.html#qiskit.circuit.ParameterExpression" title="qiskit.circuit.ParameterExpression"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParameterExpression</span></code></a>
object that the data for an INSTRUCTION_PARAM. The contents of a PARAMETER_EXPR
are defined as:</p>
<p>The PARAMETER_EXPR data starts with a header:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">map_elements</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">expr_size</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Immediately following the header is <code class="docutils literal notranslate"><span class="pre">expr_size</span></code> bytes of utf8 data containing
the expression string, which is the sympy srepr of the expression for the
parameter expression. Follwing that is a symbol map which contains
<code class="docutils literal notranslate"><span class="pre">map_elements</span></code> elements with the format</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">type</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Which is followed immediately by <code class="docutils literal notranslate"><span class="pre">PARAMETER</span></code> object (both the struct and utf8
name bytes) for the symbol map key. That is followed by <code class="docutils literal notranslate"><span class="pre">size</span></code> bytes for the
data of the symbol. The data format is dependent on the value of <code class="docutils literal notranslate"><span class="pre">type</span></code>. If
<code class="docutils literal notranslate"><span class="pre">type</span></code> is <code class="docutils literal notranslate"><span class="pre">p</span></code> then it represents a <a class="reference internal" href="../stubs/qiskit.circuit.Parameter.html#qiskit.circuit.Parameter" title="qiskit.circuit.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a> and
size will be 0, the value will just be the same as the key. If
<code class="docutils literal notranslate"><span class="pre">type</span></code> is <code class="docutils literal notranslate"><span class="pre">f</span></code> then it represents a double precision float. If <code class="docutils literal notranslate"><span class="pre">type</span></code> is
<code class="docutils literal notranslate"><span class="pre">c</span></code> it represents a double precision complex, which is represented by <a class="reference internal" href="#qpy-complex"><span class="std std-ref">COMPLEX</span></a>.
Finally, if type is <code class="docutils literal notranslate"><span class="pre">i</span></code> it represents an integer which is an <code class="docutils literal notranslate"><span class="pre">int64_t</span></code>.</p>
</div>
<div class="section" id="complex">
<span id="qpy-complex"></span><h4>COMPLEX<a class="headerlink" href="#complex" title="Permalink to this heading">¶</a></h4>
<p>When representing a double precision complex value in QPY the following
struct is used:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">real</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">imag</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>this matches the internal C representation of Python’s complex type. <a class="footnote-reference brackets" href="#f3" id="id7">3</a></p>
<dl class="footnote brackets">
<dt class="label" id="f1"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p><a class="reference external" href="https://tools.ietf.org/html/rfc1700">https://tools.ietf.org/html/rfc1700</a></p>
</dd>
<dt class="label" id="f2"><span class="brackets">2</span><span class="fn-backref">(<a href="#id3">1</a>,<a href="#id5">2</a>)</span></dt>
<dd><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.lib.format.html">https://numpy.org/doc/stable/reference/generated/numpy.lib.format.html</a></p>
</dd>
<dt class="label" id="f3"><span class="brackets"><a class="fn-backref" href="#id7">3</a></span></dt>
<dd><p><a class="reference external" href="https://docs.python.org/3/c-api/complex.html#c.Py_complex">https://docs.python.org/3/c-api/complex.html#c.Py_complex</a></p>
</dd>
</dl>
</div>
</div>
</div>
</div>


             </article>
             
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../stubs/qiskit.qpy.load.html" class="btn btn-neutral float-right" title="qiskit.qpy.load" accesskey="n" rel="next">Next <img src="../_static/images/chevron-right-orange.svg" class="next-page"></a>
      
      
        <a href="../stubs/qiskit.qobj.PulseLibraryItem.to_dict.html" class="btn btn-neutral" title="qiskit.qobj.PulseLibraryItem.to_dict" accesskey="p" rel="prev"><img src="../_static/images/chevron-right-orange.svg" class="previous-page"> Previous</a>
      
    </div>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, Qiskit Development Team.
      Τελευταία ενημέρωση στις 2022/07/12.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              <ul>
<li><a class="reference internal" href="#">QPY serialization (<code class="xref py py-mod docutils literal notranslate"><span class="pre">qiskit.qpy</span></code>)</a><ul>
<li><a class="reference internal" href="#using-qpy">Using QPY</a><ul>
<li><a class="reference internal" href="#api-documentation">API documentation</a></li>
<li><a class="reference internal" href="#qpy-compatibility">QPY Compatibility</a></li>
</ul>
</li>
<li><a class="reference internal" href="#qpy-format">QPY Format</a><ul>
<li><a class="reference internal" href="#version-5">Version 5</a><ul>
<li><a class="reference internal" href="#schedule-block">SCHEDULE_BLOCK</a></li>
<li><a class="reference internal" href="#schedule-block-header">SCHEDULE_BLOCK_HEADER</a></li>
<li><a class="reference internal" href="#channel">CHANNEL</a></li>
<li><a class="reference internal" href="#waveform">Waveform</a></li>
<li><a class="reference internal" href="#symbolicpulse">SymbolicPulse</a></li>
<li><a class="reference internal" href="#mapping">MAPPING</a></li>
<li><a class="reference internal" href="#circuit-calibrations">CIRCUIT_CALIBRATIONS</a></li>
<li><a class="reference internal" href="#instruction">INSTRUCTION</a></li>
<li><a class="reference internal" href="#custom-instruction">CUSTOM_INSTRUCTION</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-4">Version 4</a><ul>
<li><a class="reference internal" href="#range">RANGE</a></li>
<li><a class="reference internal" href="#sequence">SEQUENCE</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-3">Version 3</a><ul>
<li><a class="reference internal" href="#pauli-evolution">PAULI_EVOLUTION</a></li>
<li><a class="reference internal" href="#sparse-pauli-op-list-elem">SPARSE_PAULI_OP_LIST_ELEM</a></li>
<li><a class="reference internal" href="#parameter-vector-element">PARAMETER_VECTOR_ELEMENT</a></li>
<li><a class="reference internal" href="#parameter-expr">PARAMETER_EXPR</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-2">Version 2</a><ul>
<li><a class="reference internal" href="#header">HEADER</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-1">Version 1</a><ul>
<li><a class="reference internal" href="#id4">HEADER</a></li>
<li><a class="reference internal" href="#metadata">METADATA</a></li>
<li><a class="reference internal" href="#registers">REGISTERS</a></li>
<li><a class="reference internal" href="#custom-definitions">CUSTOM_DEFINITIONS</a></li>
<li><a class="reference internal" href="#instructions">INSTRUCTIONS</a></li>
<li><a class="reference internal" href="#parameter">PARAMETER</a></li>
<li><a class="reference internal" href="#qpy-param-expr">PARAMETER_EXPR</a></li>
<li><a class="reference internal" href="#complex">COMPLEX</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            </div>
          </div>
        </div>
      </section>
    </div>

  

     
       <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
         <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
         <script src="../_static/jquery.js"></script>
         <script src="../_static/underscore.js"></script>
         <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
         <script src="../_static/doctools.js"></script>
         <script src="../_static/thebelab-helper.js"></script>
         <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
         <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
         <script src="../_static/design-tabs.js"></script>
         <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
     

  

  <script type="text/javascript" src="../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

  <div>
    <br>
  </div>

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://qiskit.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="../getting_started.html">Getting Started</a>
          </li>
          <li>
            <a href="../tutorials.html">Tutorials</a>
          </li>
          <li>
            <a href="https://qiskit.org/documentation/partners/">Partners</a>
          </li>
          <br>
          <li class="resources-mobile-menu-title">
            Applications
          </li>
          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://qiskit.org/documentation/machine-learning/">Machine learning</a>
            </li>

            <li>
              <a href="https://qiskit.org/documentation/nature/">Nature</a>
            </li>

            <li>
              <a href="https://qiskit.org/documentation/finance/">Finance</a>
            </li>

            <li>
              <a href="https://qiskit.org/documentation/optimization/">Optimization</a>
            </li>
          </ul>
          <br>
          <li>
            <a href="https://qiskit.org/documentation/experiments/">Experiments</a>
          </li>
          <br>
          <li class="resources-mobile-menu-title">
            Resources
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://qiskit.slack.com">Slack support</a>
            </li>
          </ul>
          <br>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>