


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="pt-PT" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="pt-PT" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Transpiler Passes and Pass Manager &mdash; Documentação Qiskit 0.27.0</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/jupyter-sphinx.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/thebelab.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme-override.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/panels-variables.ade9f9d55df9d2893fc676ecd59723a1.css" type="text/css" />
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Pesquisar" href="../../search.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://qiskit.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="../../getting_started.html">Getting started</a>
          </li>

          <li>
            <a href="../../tutorials.html">Tutorials</a>
          </li>

          <li>
            <a href="https://qiskit.org/documentation/partners/" target="_blank">Providers</a>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-orange-arrow">
                Applications
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://qiskit.org/documentation/machine-learning/">
                  <span class="dropdown-title">Machine learning</span>
                  <p>QSVM, VQC (Variational Quantum Classifier), and QGAN (Quantum Generative
                    Adversarial Network) algorithms.</p>
                </a>
                <a class="nav-dropdown-item" href="https://qiskit.org/documentation/nature/">
                  <span class="dropdown-title">Nature</span>
                  <p>Quantum applications in chemistry, physics, and biology.</p>
                </a>
                <a class="nav-dropdown-item" href="https://qiskit.org/documentation/finance/">
                  <span class="dropdown-title">Finance</span>
                  <p>Uncertainty components for stock/securities problems, Ising translators for
                    portfolio optimizations and data providers to source real or random data.</p>
                </a>
                <a class="nav-dropdown-item" href="https://qiskit.org/documentation/optimization/">
                  <span class="dropdown-title">Optimization</span>
                  <p>High-level optimization problems that are ready to
                    run on simulators and real quantum devices</p>
                </a>
              </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-orange-arrow">
                Resources
              </a>
              <div class="resources-dropdown-menu">
                <a class="doc-dropdown-option nav-dropdown-item" href="https://qiskit.slack.com">
                  <span class="dropdown-title">Slack support</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://qiskit.org/textbook">
                  <span class="dropdown-title">Qiskit Textbook</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://qiskit.org/events">
                  <span class="dropdown-title">Qiskit events</span>
                  <p></p>
                </a>
            </div>
          </li>
          <li>
            <a href="https://github.com/Qiskit/" target="_blank">Github</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>

  </div>
</div>


<body class="pytorch-body">

   

    

    <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="rst-current-version-label">pt_PT</span>
    <span class="rst-versions-dropdown-icon"></span>
  </span>
  <div class="rst-other-versions">
    
    <dl>
      <dt>Languages</dt>
      
        <dd><a class="version" href="/documentation/tutorials/circuits_advanced/04_transpiler_passes_and_passmanager.html">English</a></dd>
      
        <dd><a class="version" href="/documentation/locale/ja_JP/tutorials/circuits_advanced/04_transpiler_passes_and_passmanager.html">Japanese</a></dd>
      
        <dd><a class="version" href="/documentation/locale/de_DE/tutorials/circuits_advanced/04_transpiler_passes_and_passmanager.html">German</a></dd>
      
        <dd><a class="version" href="/documentation/locale/ko_KR/tutorials/circuits_advanced/04_transpiler_passes_and_passmanager.html">Korean</a></dd>
      
        <dd><a class="version" href="/documentation/locale/pt_BR/tutorials/circuits_advanced/04_transpiler_passes_and_passmanager.html">Portuguese, Brazilian</a></dd>
      
        <dd><a class="version" href="/documentation/locale/fr_FR/tutorials/circuits_advanced/04_transpiler_passes_and_passmanager.html">French</a></dd>
      
        <dd><a class="version" href="/documentation/locale/ta_IN/tutorials/circuits_advanced/04_transpiler_passes_and_passmanager.html">Tamil</a></dd>
      
    </dl>
    
    <dl>
      <dt>Previous Releases</dt>
      
        <dd><a class="version" href="/documentation/stable/0.24/index.html">0.24</a></dd>
      
        <dd><a class="version" href="/documentation/stable/0.25/index.html">0.25</a></dd>
      
        <dd><a class="version" href="/documentation/stable/0.26/index.html">0.26</a></dd>
      
    </dl>
  </div>
  <script>
    jQuery('.version').click((evt) => {
      const hash = window.location.hash
      const complete_url = evt.target.href + hash
      window.location = complete_url
      evt.preventDefault()
    })
  </script>
</div>

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            

            
              
              
            

            


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

            
          </div>

          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Documentation homepage</a></li>
</ul>
<p><span class="caption-text">Frontmatter</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../qc_intro.html">Quantum computing in a nutshell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro_tutorial1.html">Introduction to Qiskit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing_to_qiskit.html">Contributing to Qiskit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration.html">Local Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">Frequently Asked Questions</a></li>
</ul>
<p><span class="caption-text">Libraries</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../apidoc/circuit_library.html">Circuit Library</a></li>
</ul>
<p><span class="caption-text">API References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../apidoc/terra.html">Qiskit (Terra)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apidoc/aer.html">Qiskit Simulator (Aer)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apidoc/ignis.html">Qiskit Experiments (Ignis)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apidoc/aqua.html">Qiskit Application Modules (Aqua)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apidoc/ibmq-provider.html">Qiskit IBM Quantum (Provider)</a></li>
</ul>
<p><span class="caption-text">Qiskit Applications (Aqua) Migration Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../aqua_migration.html">Qiskit Applications (Aqua) Migration Guide</a></li>
</ul>
<p><span class="caption-text">Troubleshooting</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://quantum-computing.ibm.com/lab/docs/iql/manage/errors">IBM Quantum API error codes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="../../index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
      <li>Transpiler Passes and Pass Manager</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
            
            <a href="../../_sources/tutorials/circuits_advanced/04_transpiler_passes_and_passmanager.ipynb" rel="nofollow"><img src="../../_static/images/view-page-source-icon.svg"></a>
          
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">
          
          <div class="rst-content style-external-links">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>This page was generated from <a class="reference external" href="https://github.com/Qiskit/qiskit-tutorials/blob/master/tutorials/circuits_advanced/04_transpiler_passes_and_passmanager.ipynb">tutorials/circuits_advanced/04_transpiler_passes_and_passmanager.ipynb</a>.</p>
</div>
<section id="Transpiler-Passes-and-Pass-Manager">
<h1>Transpiler Passes and Pass Manager<a class="headerlink" href="#Transpiler-Passes-and-Pass-Manager" title="Link permanente para este título">¶</a></h1>
<section id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Link permanente para este título">¶</a></h2>
<p>A central component of Qiskit Terra is the transpiler, which is designed for modularity and extensibility. The goal is to be able to easily write new circuit transformations (known as transpiler <strong>passes</strong>), and combine them with other existing passes. Which passes are chained together and in which order has a major effect on the final outcome. This pipeline is determined by a <strong>pass manager</strong>, which schedules the passes and also allows passes to communicate with each other by providing a shared
space. In this way, the transpiler opens up the door for research into aggressive optimization of quantum circuits.</p>
<p>In this notebook, we look at the built-in passes, how to use the pass manager, and develop a simple custom transpiler pass. In order to do the latter, we first need to introduce the internal representation of quantum circuits in Qiskit, in the form of a Directed Acyclic Graph, or <strong>DAG</strong>. Then, we illustrate a simple swap mapper pass, which transforms an input circuit to be compatible with a limited-connectivity quantum device.</p>
<p><strong>Before you start</strong>: You may need to install the <code class="docutils literal notranslate"><span class="pre">pydot</span></code> library and the <code class="docutils literal notranslate"><span class="pre">graphviz</span></code> library for the DAG plotting routines. If you are using Anaconda Python, you can install both with the <code class="docutils literal notranslate"><span class="pre">conda</span></code> command. If you use your system’s native Python interpreter, install <code class="docutils literal notranslate"><span class="pre">pydot</span></code> using the <code class="docutils literal notranslate"><span class="pre">pip</span></code> command, and install <code class="docutils literal notranslate"><span class="pre">graphviz</span></code> using your system’s native package manager (e.g. <code class="docutils literal notranslate"><span class="pre">yum</span></code>, <code class="docutils literal notranslate"><span class="pre">apt</span></code>, <code class="docutils literal notranslate"><span class="pre">dnf</span></code>, <code class="docutils literal notranslate"><span class="pre">brew</span></code>, etc.).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">QuantumCircuit</span>
<span class="kn">from</span> <span class="nn">qiskit.compiler</span> <span class="kn">import</span> <span class="n">transpile</span>
<span class="kn">from</span> <span class="nn">qiskit.transpiler</span> <span class="kn">import</span> <span class="n">PassManager</span>
</pre></div>
</div>
</div>
</section>
<section id="PassManager-object">
<h2>PassManager object<a class="headerlink" href="#PassManager-object" title="Link permanente para este título">¶</a></h2>
<p>Lets you specify the set of passes you want.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">circ</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">ccx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_5_0.png" src="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_5_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qiskit.transpiler.passes</span> <span class="kn">import</span> <span class="n">Unroller</span>
<span class="n">pass_</span> <span class="o">=</span> <span class="n">Unroller</span><span class="p">([</span><span class="s1">&#39;u1&#39;</span><span class="p">,</span> <span class="s1">&#39;u2&#39;</span><span class="p">,</span> <span class="s1">&#39;u3&#39;</span><span class="p">,</span> <span class="s1">&#39;cx&#39;</span><span class="p">])</span>
<span class="n">pm</span> <span class="o">=</span> <span class="n">PassManager</span><span class="p">(</span><span class="n">pass_</span><span class="p">)</span>
<span class="n">new_circ</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
<span class="n">new_circ</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_6_0.png" src="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_6_0.png" />
</div>
</div>
<p>All of Qiskit’s transpiler passes are accessible from <code class="docutils literal notranslate"><span class="pre">qiskit.transpiler.passes</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qiskit.transpiler</span> <span class="kn">import</span> <span class="n">passes</span>
<span class="p">[</span><span class="n">pass_</span> <span class="k">for</span> <span class="n">pass_</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">passes</span><span class="p">)</span> <span class="k">if</span> <span class="n">pass_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;ApplyLayout&#39;,
 &#39;BarrierBeforeFinalMeasurements&#39;,
 &#39;BasicSwap&#39;,
 &#39;BasisTranslator&#39;,
 &#39;CSPLayout&#39;,
 &#39;CXCancellation&#39;,
 &#39;CXDirection&#39;,
 &#39;CheckCXDirection&#39;,
 &#39;CheckMap&#39;,
 &#39;Collect2qBlocks&#39;,
 &#39;CommutationAnalysis&#39;,
 &#39;CommutativeCancellation&#39;,
 &#39;ConsolidateBlocks&#39;,
 &#39;CountOps&#39;,
 &#39;CountOpsLongestPath&#39;,
 &#39;CrosstalkAdaptiveSchedule&#39;,
 &#39;DAGFixedPoint&#39;,
 &#39;DAGLongestPath&#39;,
 &#39;Decompose&#39;,
 &#39;DenseLayout&#39;,
 &#39;Depth&#39;,
 &#39;EnlargeWithAncilla&#39;,
 &#39;FixedPoint&#39;,
 &#39;FullAncillaAllocation&#39;,
 &#39;HoareOptimizer&#39;,
 &#39;Layout2qDistance&#39;,
 &#39;LayoutTransformation&#39;,
 &#39;LookaheadSwap&#39;,
 &#39;MergeAdjacentBarriers&#39;,
 &#39;NoiseAdaptiveLayout&#39;,
 &#39;NumTensorFactors&#39;,
 &#39;Optimize1qGates&#39;,
 &#39;OptimizeSwapBeforeMeasure&#39;,
 &#39;RemoveDiagonalGatesBeforeMeasure&#39;,
 &#39;RemoveFinalMeasurements&#39;,
 &#39;RemoveResetInZeroState&#39;,
 &#39;ResourceEstimation&#39;,
 &#39;SabreLayout&#39;,
 &#39;SabreSwap&#39;,
 &#39;SetLayout&#39;,
 &#39;Size&#39;,
 &#39;StochasticSwap&#39;,
 &#39;TrivialLayout&#39;,
 &#39;UnitarySynthesis&#39;,
 &#39;Unroll3qOrMore&#39;,
 &#39;UnrollCustomDefinitions&#39;,
 &#39;Unroller&#39;,
 &#39;Width&#39;]
</pre></div></div>
</div>
</section>
<section id="Different-Variants-of-the-Same-Pass">
<h2>Different Variants of the Same Pass<a class="headerlink" href="#Different-Variants-of-the-Same-Pass" title="Link permanente para este título">¶</a></h2>
<p>There can be passes that do the same job, but in different ways. For example, the <code class="docutils literal notranslate"><span class="pre">TrivialLayout</span></code>, <code class="docutils literal notranslate"><span class="pre">DenseLayout</span></code> and <code class="docutils literal notranslate"><span class="pre">NoiseAdaptiveLayout</span></code> all choose a layout (binding of virtual qubits to physical qubits), but use different algorithms and objectives. Similarly, the <code class="docutils literal notranslate"><span class="pre">BasicSwap</span></code>, <code class="docutils literal notranslate"><span class="pre">LookaheadSwap</span></code> and <code class="docutils literal notranslate"><span class="pre">StochasticSwap</span></code> all insert swaps to make the circuit compatible with the coupling map. The modularity of the transpiler allows plug-and-play replacements for each pass.</p>
<p>Below, we show the swapper passes all applied to the same circuit, to transform it to match a linear chain topology. You can see differences in performance, where the <code class="docutils literal notranslate"><span class="pre">StochasticSwap</span></code> is clearly the best. However, this can vary depending on the input circuit.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qiskit.transpiler</span> <span class="kn">import</span> <span class="n">CouplingMap</span><span class="p">,</span> <span class="n">Layout</span>
<span class="kn">from</span> <span class="nn">qiskit.transpiler.passes</span> <span class="kn">import</span> <span class="n">BasicSwap</span><span class="p">,</span> <span class="n">LookaheadSwap</span><span class="p">,</span> <span class="n">StochasticSwap</span>

<span class="n">coupling</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span>

<span class="n">circuit</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">circuit</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">circuit</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">circuit</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">circuit</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">circuit</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">circuit</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">coupling_map</span> <span class="o">=</span> <span class="n">CouplingMap</span><span class="p">(</span><span class="n">couplinglist</span><span class="o">=</span><span class="n">coupling</span><span class="p">)</span>

<span class="n">bs</span> <span class="o">=</span> <span class="n">BasicSwap</span><span class="p">(</span><span class="n">coupling_map</span><span class="o">=</span><span class="n">coupling_map</span><span class="p">)</span>
<span class="n">pass_manager</span> <span class="o">=</span> <span class="n">PassManager</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
<span class="n">basic_circ</span> <span class="o">=</span> <span class="n">pass_manager</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circuit</span><span class="p">)</span>

<span class="n">ls</span> <span class="o">=</span> <span class="n">LookaheadSwap</span><span class="p">(</span><span class="n">coupling_map</span><span class="o">=</span><span class="n">coupling_map</span><span class="p">)</span>
<span class="n">pass_manager</span> <span class="o">=</span> <span class="n">PassManager</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span>
<span class="n">lookahead_circ</span> <span class="o">=</span> <span class="n">pass_manager</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circuit</span><span class="p">)</span>

<span class="n">ss</span> <span class="o">=</span> <span class="n">StochasticSwap</span><span class="p">(</span><span class="n">coupling_map</span><span class="o">=</span><span class="n">coupling_map</span><span class="p">)</span>
<span class="n">pass_manager</span> <span class="o">=</span> <span class="n">PassManager</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>
<span class="n">stochastic_circ</span> <span class="o">=</span> <span class="n">pass_manager</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circuit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">circuit</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_11_0.png" src="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_11_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">basic_circ</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_12_0.png" src="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_12_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lookahead_circ</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_13_0.png" src="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_13_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">stochastic_circ</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_14_0.png" src="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_14_0.png" />
</div>
</div>
</section>
<section id="Preset-Pass-Managers">
<h2>Preset Pass Managers<a class="headerlink" href="#Preset-Pass-Managers" title="Link permanente para este título">¶</a></h2>
<p>Qiskit comes with several pre-defined pass managers, corresponding to various levels of optimization achieved through different pipelines of passes. Currently <code class="docutils literal notranslate"><span class="pre">optimization_level</span></code> 0 through 3 are supported; the higher the number, the more optimized it is, at the expense of more time. Choosing a good pass manager may take trial and error, as it depends heavily on the circuit being transpiled and the backend being targeted.</p>
<p>Here we illustrate the different levels by looking at a state synthesis circuit. We initialize four qubits to an arbitrary state, and then try to optimize the circuit that achieves this.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">optimization_level=0</span></code>: just maps the circuit to the backend, with no explicit optimization (except whatever optimizations the mapper does).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">optimization_level=1</span></code>: maps the circuit, but also does light-weight optimizations by collapsing adjacent gates.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">optimization_level=2</span></code>: medium-weight optimization, including a noise-adaptive layout and a gate-cancellation procedure based on gate commutation relationships.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">optimization_level=3</span></code>: heavy-weight optimization, which in addition to previous steps, does resynthesis of two-qubit blocks of gates in the circuit.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">qiskit.test.mock</span> <span class="kn">import</span> <span class="n">FakeTokyo</span>

<span class="n">backend</span> <span class="o">=</span> <span class="n">FakeTokyo</span><span class="p">()</span>     <span class="c1"># mimics the tokyo device in terms of coupling map and basis gates</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="n">random_state</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="nb">complex</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="nb">complex</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="nb">complex</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="nb">complex</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>

<span class="n">qc</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">random_state</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<pre style="word-wrap: normal;white-space: pre;background: #fff0;line-height: 1.1;font-family: &quot;Courier New&quot;,Courier,monospace">     »
q_0: »
     »
q_1: »
     »
q_2: »
     »
q_3: »
     »
q_4: »
     »
q_5: »
     »
q_6: »
     »
q_7: »
     »
q_8: »
     »
q_9: »
     »
«     ┌────────────────────────────────────────────────────────────────────────────┐
«q_0: ┤0                                                                           ├
«     │                                                                            │
«q_1: ┤1                                                                           ├
«     │  initialize(0.5j,0.35355,0,0,0,0,0,0,0.35355,0.35355j,0,0,0,0,0.5,0.35355) │
«q_2: ┤2                                                                           ├
«     │                                                                            │
«q_3: ┤3                                                                           ├
«     └────────────────────────────────────────────────────────────────────────────┘
«q_4: ──────────────────────────────────────────────────────────────────────────────
«
«q_5: ──────────────────────────────────────────────────────────────────────────────
«
«q_6: ──────────────────────────────────────────────────────────────────────────────
«
«q_7: ──────────────────────────────────────────────────────────────────────────────
«
«q_8: ──────────────────────────────────────────────────────────────────────────────
«
«q_9: ──────────────────────────────────────────────────────────────────────────────
«                                                                                   </pre></div>
</div>
<p>Now map this to the 20-qubit Tokyo device, with different optimization levels:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">optimized_0</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span> <span class="n">seed_transpiler</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">optimization_level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;gates = &#39;</span><span class="p">,</span> <span class="n">optimized_0</span><span class="o">.</span><span class="n">count_ops</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;depth = &#39;</span><span class="p">,</span> <span class="n">optimized_0</span><span class="o">.</span><span class="n">depth</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
gates =  OrderedDict([(&#39;cx&#39;, 55), (&#39;u3&#39;, 15), (&#39;u1&#39;, 15), (&#39;reset&#39;, 4)])
depth =  69
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">optimized_1</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span> <span class="n">seed_transpiler</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">optimization_level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;gates = &#39;</span><span class="p">,</span> <span class="n">optimized_1</span><span class="o">.</span><span class="n">count_ops</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;depth = &#39;</span><span class="p">,</span> <span class="n">optimized_1</span><span class="o">.</span><span class="n">depth</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
gates =  OrderedDict([(&#39;cx&#39;, 55), (&#39;u3&#39;, 15), (&#39;u1&#39;, 6)])
depth =  59
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">optimized_2</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span> <span class="n">seed_transpiler</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">optimization_level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;gates = &#39;</span><span class="p">,</span> <span class="n">optimized_2</span><span class="o">.</span><span class="n">count_ops</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;depth = &#39;</span><span class="p">,</span> <span class="n">optimized_2</span><span class="o">.</span><span class="n">depth</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
gates =  OrderedDict([(&#39;cx&#39;, 45), (&#39;u3&#39;, 15), (&#39;u1&#39;, 6)])
depth =  55
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">optimized_3</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span> <span class="n">seed_transpiler</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">optimization_level</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;gates = &#39;</span><span class="p">,</span> <span class="n">optimized_3</span><span class="o">.</span><span class="n">count_ops</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;depth = &#39;</span><span class="p">,</span> <span class="n">optimized_3</span><span class="o">.</span><span class="n">depth</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
gates =  OrderedDict([(&#39;cx&#39;, 20), (&#39;u3&#39;, 15), (&#39;u1&#39;, 6)])
depth =  38
</pre></div></div>
</div>
</section>
<section id="Introducing-the-DAG">
<h2>Introducing the DAG<a class="headerlink" href="#Introducing-the-DAG" title="Link permanente para este título">¶</a></h2>
<p>In Qiskit, we represent circuits internally using a Directed Acyclic Graph (DAG). The advantage of this representation over a pure list of gates (i.e., <em>netlist</em>) is that the flow of information between operations are explicit, making it easier for passes to make transformation decisions without changing the semantics of the circuit.</p>
<p>Let’s start by building a simple circuit, and examining its DAG.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">QuantumRegister</span><span class="p">,</span> <span class="n">ClassicalRegister</span><span class="p">,</span> <span class="n">QuantumCircuit</span>
<span class="kn">from</span> <span class="nn">qiskit.dagcircuit</span> <span class="kn">import</span> <span class="n">DAGCircuit</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">)</span>
<span class="n">circ</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">circ</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">circ</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">circ</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">c_if</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_25_0.png" src="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_25_0.png" />
</div>
</div>
<p>In the DAG, there are three kinds of graph nodes: qubit/clbit input nodes (green), operation nodes (blue), and output nodes (red). Each edge indicates data flow (or dependency) between two nodes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qiskit.converters</span> <span class="kn">import</span> <span class="n">circuit_to_dag</span>
<span class="kn">from</span> <span class="nn">qiskit.tools.visualization</span> <span class="kn">import</span> <span class="n">dag_drawer</span>
<span class="n">dag</span> <span class="o">=</span> <span class="n">circuit_to_dag</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
<span class="n">dag_drawer</span><span class="p">(</span><span class="n">dag</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_27_0.png" src="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_27_0.png" />
</div>
</div>
<p>Therefore, writing a transpiler pass means using Qiskit’s DAGCircuit API to analyze or transform the circuit. Let’s see some examples of this.</p>
<p><strong>a. Get all op nodes in the DAG:</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dag</span><span class="o">.</span><span class="n">op_nodes</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;qiskit.dagcircuit.dagnode.DAGNode at 0x7f1eebb870b0&gt;,
 &lt;qiskit.dagcircuit.dagnode.DAGNode at 0x7f1eebb87820&gt;,
 &lt;qiskit.dagcircuit.dagnode.DAGNode at 0x7f1eebb87eb0&gt;,
 &lt;qiskit.dagcircuit.dagnode.DAGNode at 0x7f1eebb876d0&gt;]
</pre></div></div>
</div>
<p>Each node is an instance of the <code class="docutils literal notranslate"><span class="pre">DAGNode</span></code> class. Let’s examine the information stored in the second op node.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">node</span> <span class="o">=</span> <span class="n">dag</span><span class="o">.</span><span class="n">op_nodes</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;node name: &quot;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;node op: &quot;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;node qargs: &quot;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">qargs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;node cargs: &quot;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">cargs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;node condition: &quot;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">condition</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
node name:  rz
node op:  &lt;qiskit.circuit.library.standard_gates.rz.RZGate object at 0x7f1eec144e20&gt;
node qargs:  [Qubit(QuantumRegister(3, &#39;q&#39;), 1)]
node cargs:  []
node condition:  (ClassicalRegister(3, &#39;c&#39;), 2)
</pre></div></div>
</div>
<p><strong>b. Add an operation to the back:</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qiskit.circuit.library</span> <span class="kn">import</span> <span class="n">HGate</span>
<span class="n">dag</span><span class="o">.</span><span class="n">apply_operation_back</span><span class="p">(</span><span class="n">HGate</span><span class="p">(),</span> <span class="n">qargs</span><span class="o">=</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">dag_drawer</span><span class="p">(</span><span class="n">dag</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_34_0.png" src="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_34_0.png" />
</div>
</div>
<p><strong>c. Add an operation to the front:</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qiskit.circuit.library</span> <span class="kn">import</span> <span class="n">CCXGate</span>
<span class="n">dag</span><span class="o">.</span><span class="n">apply_operation_front</span><span class="p">(</span><span class="n">CCXGate</span><span class="p">(),</span> <span class="n">qargs</span><span class="o">=</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">cargs</span><span class="o">=</span><span class="p">[])</span>
<span class="n">dag_drawer</span><span class="p">(</span><span class="n">dag</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_36_0.png" src="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_36_0.png" />
</div>
</div>
<p><strong>d. Substitute a node with a subcircuit:</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qiskit.circuit.library</span> <span class="kn">import</span> <span class="n">CHGate</span><span class="p">,</span> <span class="n">U2Gate</span><span class="p">,</span> <span class="n">CXGate</span>
<span class="n">mini_dag</span> <span class="o">=</span> <span class="n">DAGCircuit</span><span class="p">()</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">)</span>
<span class="n">mini_dag</span><span class="o">.</span><span class="n">add_qreg</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="n">mini_dag</span><span class="o">.</span><span class="n">apply_operation_back</span><span class="p">(</span><span class="n">CHGate</span><span class="p">(),</span> <span class="n">qargs</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">mini_dag</span><span class="o">.</span><span class="n">apply_operation_back</span><span class="p">(</span><span class="n">U2Gate</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">qargs</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

<span class="c1"># substitute the cx node with the above mini-dag</span>
<span class="n">cx_node</span> <span class="o">=</span> <span class="n">dag</span><span class="o">.</span><span class="n">op_nodes</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="n">CXGate</span><span class="p">)</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="n">dag</span><span class="o">.</span><span class="n">substitute_node_with_dag</span><span class="p">(</span><span class="n">node</span><span class="o">=</span><span class="n">cx_node</span><span class="p">,</span> <span class="n">input_dag</span><span class="o">=</span><span class="n">mini_dag</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">dag_drawer</span><span class="p">(</span><span class="n">dag</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_38_0.png" src="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_38_0.png" />
</div>
</div>
<p>Finally, after all transformations are complete, we can convert back to a regular QuantumCircuit object. This is what the transpiler does! It takes a circuit, operates on it in DAG form, and outputs a transformed circuit.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qiskit.converters</span> <span class="kn">import</span> <span class="n">dag_to_circuit</span>
<span class="n">circuit</span> <span class="o">=</span> <span class="n">dag_to_circuit</span><span class="p">(</span><span class="n">dag</span><span class="p">)</span>
<span class="n">circuit</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_40_0.png" src="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_40_0.png" />
</div>
</div>
</section>
<section id="Implementing-a-BasicMapper-Pass">
<h2>Implementing a BasicMapper Pass<a class="headerlink" href="#Implementing-a-BasicMapper-Pass" title="Link permanente para este título">¶</a></h2>
<p>Now that we are familiar with the DAG, let’s use it to write a transpiler pass. Here we will implement a basic pass for mapping an arbitrary circuit to a device with limited qubit connectivity. We call this the BasicMapper. This pass is included in Qiskit Terra as well.</p>
<p>The first thing to do when writing a transpiler pass is to decide whether the pass class derives from a <code class="docutils literal notranslate"><span class="pre">TransformationPass</span></code> or <code class="docutils literal notranslate"><span class="pre">AnalysisPass</span></code>. Transformation passes modify the circuit, while analysis passes only collect information about a circuit (to be used by other passes). Then, the <code class="docutils literal notranslate"><span class="pre">run(dag)</span></code> method is implemented, which does the main task. Finally, the pass is registered inside the <code class="docutils literal notranslate"><span class="pre">qiskit.transpiler.passes</span></code> module.</p>
<p>This pass functions as follows: it traverses the DAG layer-by-layer (each layer is a group of operations that does not act on independent qubits, so in theory all operations in a layer can be done independently). For each operation, if it does not already meet the coupling map constraints, the pass identifies a swap path and inserts swaps to bring the two qubits close to each other.</p>
<p>Follow the comments in the code for more details.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>

<span class="kn">from</span> <span class="nn">qiskit.transpiler.basepasses</span> <span class="kn">import</span> <span class="n">TransformationPass</span>
<span class="kn">from</span> <span class="nn">qiskit.transpiler</span> <span class="kn">import</span> <span class="n">Layout</span>
<span class="kn">from</span> <span class="nn">qiskit.circuit.library</span> <span class="kn">import</span> <span class="n">SwapGate</span>


<span class="k">class</span> <span class="nc">BasicSwap</span><span class="p">(</span><span class="n">TransformationPass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Maps (with minimum effort) a DAGCircuit onto a `coupling_map` adding swap gates.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">coupling_map</span><span class="p">,</span>
                 <span class="n">initial_layout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Maps a DAGCircuit onto a `coupling_map` using swap gates.</span>

<span class="sd">        Args:</span>
<span class="sd">            coupling_map (CouplingMap): Directed graph represented a coupling map.</span>
<span class="sd">            initial_layout (Layout): initial layout of qubits in mapping</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coupling_map</span> <span class="o">=</span> <span class="n">coupling_map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_layout</span> <span class="o">=</span> <span class="n">initial_layout</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dag</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Runs the BasicSwap pass on `dag`.</span>

<span class="sd">        Args:</span>
<span class="sd">            dag (DAGCircuit): DAG to map.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DAGCircuit: A mapped DAG.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TranspilerError: if the coupling map or the layout are not</span>
<span class="sd">            compatible with the DAG.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_dag</span> <span class="o">=</span> <span class="n">DAGCircuit</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">qreg</span> <span class="ow">in</span> <span class="n">dag</span><span class="o">.</span><span class="n">qregs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">new_dag</span><span class="o">.</span><span class="n">add_qreg</span><span class="p">(</span><span class="n">qreg</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">creg</span> <span class="ow">in</span> <span class="n">dag</span><span class="o">.</span><span class="n">cregs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">new_dag</span><span class="o">.</span><span class="n">add_creg</span><span class="p">(</span><span class="n">creg</span><span class="p">)</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_layout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">property_set</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">initial_layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">property_set</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">initial_layout</span> <span class="o">=</span> <span class="n">Layout</span><span class="o">.</span><span class="n">generate_trivial_layout</span><span class="p">(</span><span class="o">*</span><span class="n">dag</span><span class="o">.</span><span class="n">qregs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dag</span><span class="o">.</span><span class="n">qubits</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_layout</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">TranspilerError</span><span class="p">(</span><span class="s1">&#39;The layout does not match the amount of qubits in the DAG&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coupling_map</span><span class="o">.</span><span class="n">physical_qubits</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_layout</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">TranspilerError</span><span class="p">(</span>
                <span class="s2">&quot;Mappers require to have the layout to be the same size as the coupling map&quot;</span><span class="p">)</span>

        <span class="n">canonical_register</span> <span class="o">=</span> <span class="n">dag</span><span class="o">.</span><span class="n">qregs</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span>
        <span class="n">trivial_layout</span> <span class="o">=</span> <span class="n">Layout</span><span class="o">.</span><span class="n">generate_trivial_layout</span><span class="p">(</span><span class="n">canonical_register</span><span class="p">)</span>
        <span class="n">current_layout</span> <span class="o">=</span> <span class="n">trivial_layout</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">dag</span><span class="o">.</span><span class="n">serial_layers</span><span class="p">():</span>
            <span class="n">subdag</span> <span class="o">=</span> <span class="n">layer</span><span class="p">[</span><span class="s1">&#39;graph&#39;</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="n">subdag</span><span class="o">.</span><span class="n">two_qubit_ops</span><span class="p">():</span>
                <span class="n">physical_q0</span> <span class="o">=</span> <span class="n">current_layout</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">qargs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">physical_q1</span> <span class="o">=</span> <span class="n">current_layout</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">qargs</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coupling_map</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">physical_q0</span><span class="p">,</span> <span class="n">physical_q1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># Insert a new layer with the SWAP(s).</span>
                    <span class="n">swap_layer</span> <span class="o">=</span> <span class="n">DAGCircuit</span><span class="p">()</span>
                    <span class="n">swap_layer</span><span class="o">.</span><span class="n">add_qreg</span><span class="p">(</span><span class="n">canonical_register</span><span class="p">)</span>

                    <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coupling_map</span><span class="o">.</span><span class="n">shortest_undirected_path</span><span class="p">(</span><span class="n">physical_q0</span><span class="p">,</span> <span class="n">physical_q1</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">swap</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
                        <span class="n">connected_wire_1</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">swap</span><span class="p">]</span>
                        <span class="n">connected_wire_2</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">swap</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

                        <span class="n">qubit_1</span> <span class="o">=</span> <span class="n">current_layout</span><span class="p">[</span><span class="n">connected_wire_1</span><span class="p">]</span>
                        <span class="n">qubit_2</span> <span class="o">=</span> <span class="n">current_layout</span><span class="p">[</span><span class="n">connected_wire_2</span><span class="p">]</span>

                        <span class="c1"># create the swap operation</span>
                        <span class="n">swap_layer</span><span class="o">.</span><span class="n">apply_operation_back</span><span class="p">(</span><span class="n">SwapGate</span><span class="p">(),</span>
                                                        <span class="n">qargs</span><span class="o">=</span><span class="p">[</span><span class="n">qubit_1</span><span class="p">,</span> <span class="n">qubit_2</span><span class="p">],</span>
                                                        <span class="n">cargs</span><span class="o">=</span><span class="p">[])</span>

                    <span class="c1"># layer insertion</span>
                    <span class="n">order</span> <span class="o">=</span> <span class="n">current_layout</span><span class="o">.</span><span class="n">reorder_bits</span><span class="p">(</span><span class="n">new_dag</span><span class="o">.</span><span class="n">qubits</span><span class="p">)</span>
                    <span class="n">new_dag</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">swap_layer</span><span class="p">,</span> <span class="n">qubits</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>

                    <span class="c1"># update current_layout</span>
                    <span class="k">for</span> <span class="n">swap</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
                        <span class="n">current_layout</span><span class="o">.</span><span class="n">swap</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="n">swap</span><span class="p">],</span> <span class="n">path</span><span class="p">[</span><span class="n">swap</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>

            <span class="n">order</span> <span class="o">=</span> <span class="n">current_layout</span><span class="o">.</span><span class="n">reorder_bits</span><span class="p">(</span><span class="n">new_dag</span><span class="o">.</span><span class="n">qubits</span><span class="p">)</span>
            <span class="n">new_dag</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">subdag</span><span class="p">,</span> <span class="n">qubits</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_dag</span>
</pre></div>
</div>
</div>
<p>Let’s test this pass on a small example circuit.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">q</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">)</span>
<span class="n">in_circ</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<span class="n">in_circ</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">in_circ</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="n">in_circ</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">in_circ</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">in_circ</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">in_circ</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">in_circ</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;qiskit.circuit.instructionset.InstructionSet at 0x7f1f5e2747c0&gt;
</pre></div></div>
</div>
<p>Now we construct a pass manager that contains our new pass. We pass the example circuit above to this pass manager, and obtain a new, transformed circuit.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qiskit.transpiler</span> <span class="kn">import</span> <span class="n">PassManager</span>
<span class="kn">from</span> <span class="nn">qiskit.transpiler</span> <span class="kn">import</span> <span class="n">CouplingMap</span>
<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">BasicAer</span>
<span class="n">pm</span> <span class="o">=</span> <span class="n">PassManager</span><span class="p">()</span>
<span class="n">coupling</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span>
<span class="n">coupling_map</span> <span class="o">=</span> <span class="n">CouplingMap</span><span class="p">(</span><span class="n">couplinglist</span><span class="o">=</span><span class="n">coupling</span><span class="p">)</span>

<span class="n">pm</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">BasicSwap</span><span class="p">(</span><span class="n">coupling_map</span><span class="p">)])</span>

<span class="n">out_circ</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">in_circ</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
&lt;ipython-input-24-6348c3c81f5c&gt;:50: DeprecationWarning: dag.qubits() and dag.clbits() are no longer methods. Use dag.qubits and dag.clbits properties instead.
  if len(dag.qubits()) != len(self.initial_layout):
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">in_circ</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_48_0.png" src="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_48_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">out_circ</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_49_0.png" src="../../_images/tutorials_circuits_advanced_04_transpiler_passes_and_passmanager_49_0.png" />
</div>
</div>
<p>Note that this pass only inserts the swaps necessary to make every two-qubit interaction conform to the device coupling map. It does not, for example, care about the direction of interactions, or the native gate set supported by the device. This is a design philosophy of Qiskit’s transpiler: every pass performs a small, well-defined action, and the aggressive circuit optimization is achieved by the pass manager through combining multiple passes.</p>
</section>
<section id="Transpiler-Logging">
<h2>Transpiler Logging<a class="headerlink" href="#Transpiler-Logging" title="Link permanente para este título">¶</a></h2>
<p>Due to the complexity of the internal operations that the transpiler is performing it’s likely that you’ll end up in a situation where you’d like to debug an issue or just understand more of what is happening inside the transpiler when you call it. To facilitate this the transpiler emits log messages as part of its normal operation. This logging uses the Python standard library <code class="docutils literal notranslate"><span class="pre">logging</span></code> module to emit the log messages. Python’s standard logging was used because it allows Qiskit-Terra’s
logging to integrate in a standard way with other applications and libraries.</p>
<p>For a more thorough introduction to Python logging refer to the <a class="reference external" href="https://docs.python.org/3/library/logging.html">official documentation</a> and the tutorials and cookbook linked off of there.</p>
<div class="alert alert-block alert-success"><p>Note: Most of the logging module functions used in this section adjust global settings. If you run commands in this section it might effect the output from other cells if they are run in a different order.</p>
</div><section id="Configuring-Python-Standard-Library-Logging">
<h3>Configuring Python Standard Library Logging<a class="headerlink" href="#Configuring-Python-Standard-Library-Logging" title="Link permanente para este título">¶</a></h3>
<p>By default Python Standard Logging only prints log messages at the <code class="docutils literal notranslate"><span class="pre">WARNING</span></code>, <code class="docutils literal notranslate"><span class="pre">ERROR</span></code>, or <code class="docutils literal notranslate"><span class="pre">CRITICAL</span></code> log levels. Since none of the logs emitted by the transpiler use these log levels (they’re all informative) you need to configure logging.</p>
<p>The simplest way to do this is to just run:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">basicConfig()</span></code> function (see the docs here: <a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.basicConfig">https://docs.python.org/3/library/logging.html#logging.basicConfig</a>) configures a root handler and formatter. We also specify the <a class="reference external" href="https://docs.python.org/3/library/logging.html#levels">log level</a> to display with the <code class="docutils literal notranslate"><span class="pre">level</span></code> kwarg. Setting it to a level will also include and higher levels. For example, if you set it to <code class="docutils literal notranslate"><span class="pre">'INFO'</span></code> in addition to the <code class="docutils literal notranslate"><span class="pre">INFO</span></code> level this will also include the <code class="docutils literal notranslate"><span class="pre">WARNING</span></code>, <code class="docutils literal notranslate"><span class="pre">ERROR</span></code>, and <code class="docutils literal notranslate"><span class="pre">CRITICAL</span></code> log levels.</p>
<p>Now the python environment in this notebook is configured to emit log messages to stderr when you run the transpiler. For example:</p>
<div class="alert alert-block alert-success"><p>Note: basicConfig() will only work when called the first time it’s called. It detects if a root handler and formatter have already been setup (either by using an earlier basicConfig() call or otherwise) and does nothing if they have. Further adjustments will have to by interacting with the handler directly.</p>
</div><div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qiskit.test.mock</span> <span class="kn">import</span> <span class="n">FakeTenerife</span>


<span class="n">log_circ</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">log_circ</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">log_circ</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">log_circ</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">log_circ</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">log_circ</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">log_circ</span><span class="o">.</span><span class="n">measure</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="n">backend</span> <span class="o">=</span> <span class="n">FakeTenerife</span><span class="p">()</span>

<span class="n">transpile</span><span class="p">(</span><span class="n">log_circ</span><span class="p">,</span> <span class="n">backend</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:qiskit.transpiler.runningpassmanager:Pass: SetLayout - 0.00477 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: TrivialLayout - 0.04864 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Layout2qDistance - 0.45657 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FullAncillaAllocation - 0.08535 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: EnlargeWithAncilla - 0.08416 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: ApplyLayout - 0.64754 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Unroll3qOrMore - 0.05555 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CheckMap - 0.05698 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: UnrollCustomDefinitions - 0.08774 (ms)
INFO:qiskit.transpiler.passes.basis.basis_translator:Begin BasisTranslator from source basis {(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;h&#39;, 1), (&#39;cx&#39;, 2)} to target basis {&#39;cx&#39;, &#39;barrier&#39;, &#39;id&#39;, &#39;reset&#39;, &#39;u3&#39;, &#39;u1&#39;, &#39;measure&#39;, &#39;u2&#39;, &#39;snapshot&#39;}.
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Begining basis search from frozenset({(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;h&#39;, 1), (&#39;cx&#39;, 2)}) to frozenset({&#39;reset&#39;, &#39;cx&#39;, &#39;u3&#39;, &#39;barrier&#39;, &#39;u1&#39;, &#39;measure&#39;, &#39;id&#39;, &#39;u2&#39;, &#39;snapshot&#39;}).
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Inspecting basis frozenset({(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;h&#39;, 1), (&#39;cx&#39;, 2)}).
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Inspecting basis frozenset({(&#39;measure&#39;, 1), (&#39;h&#39;, 1), (&#39;cx&#39;, 2), (&#39;u3&#39;, 1)}).
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Transformation path:
DEBUG:qiskit.transpiler.passes.basis.basis_translator:x/1 =&gt; []
     ┌─────────────┐
q_0: ┤ U3(pi,0,pi) ├
     └─────────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:h/1 =&gt; []
     ┌──────────┐
q_0: ┤ U2(0,pi) ├
     └──────────┘
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation path search completed in 0.010s.
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Composing transform step: x/1 [] =&gt;
     ┌─────────────┐
q_0: ┤ U3(pi,0,pi) ├
     └─────────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updating transform for mapped instr (&#39;x&#39;, 1) x, [] from
        ┌───┐
q293_0: ┤ x ├
        └───┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updated transform for mapped instr (&#39;x&#39;, 1) x, [] to
        ┌─────────────┐
q293_0: ┤ U3(pi,0,pi) ├
        └─────────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Composing transform step: h/1 [] =&gt;
     ┌──────────┐
q_0: ┤ U2(0,pi) ├
     └──────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updating transform for mapped instr (&#39;h&#39;, 1) h, [] from
        ┌───┐
q294_0: ┤ h ├
        └───┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updated transform for mapped instr (&#39;h&#39;, 1) h, [] to
        ┌──────────┐
q294_0: ┤ U2(0,pi) ├
        └──────────┘
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation paths composed in 0.020s.
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation instructions replaced in 0.000s.
INFO:qiskit.transpiler.runningpassmanager:Pass: BasisTranslator - 36.93509 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CheckCXDirection - 0.09489 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXDirection - 0.78416 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: RemoveResetInZeroState - 0.03719 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 0.05436 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.03481 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 1.50800 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.08798 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 0.03672 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.01812 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 0.23603 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.06080 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 0.02980 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.01717 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 0.23818 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.07939 (ms)
INFO:qiskit.compiler.transpile:Total Transpile Time - 75.43111 (ms)
</pre></div></div>
</div>
<p>As you can clearly see here when calling <code class="docutils literal notranslate"><span class="pre">transpile()</span></code> it now prints 2 types of log messages. The first is at the <code class="docutils literal notranslate"><span class="pre">INFO</span></code> log level and come from the pass manager. These indicate each pass that was executed and how long that took. The second are at the <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> level and come from the StochasticSwap pass and describes the internal operation of that pass. It’s useful for debugging issues in the pass’s operation.</p>
</section>
<section id="Adjusting-the-log-level-for-the-transpiler">
<h3>Adjusting the log level for the transpiler<a class="headerlink" href="#Adjusting-the-log-level-for-the-transpiler" title="Link permanente para este título">¶</a></h3>
<p>The qiskit transpiler uses a single namespace <code class="docutils literal notranslate"><span class="pre">qiskit.transpiler</span></code>, as used by <code class="docutils literal notranslate"><span class="pre">logging.getLogger('qiskit.transpiler')</span></code>. This makes it very easy to adjust the log level for just the transpiler. For example if you only wish to see log messages at the INFO level or above you can run:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;qiskit.transpiler&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
<span class="n">transpile</span><span class="p">(</span><span class="n">log_circ</span><span class="p">,</span> <span class="n">backend</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:qiskit.transpiler.runningpassmanager:Pass: SetLayout - 0.00572 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: TrivialLayout - 0.04363 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Layout2qDistance - 0.42200 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FullAncillaAllocation - 0.06890 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: EnlargeWithAncilla - 0.08631 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: ApplyLayout - 0.56601 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Unroll3qOrMore - 0.02265 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CheckMap - 0.04959 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: UnrollCustomDefinitions - 0.04530 (ms)
INFO:qiskit.transpiler.passes.basis.basis_translator:Begin BasisTranslator from source basis {(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;h&#39;, 1), (&#39;cx&#39;, 2)} to target basis {&#39;cx&#39;, &#39;barrier&#39;, &#39;id&#39;, &#39;reset&#39;, &#39;u3&#39;, &#39;u1&#39;, &#39;measure&#39;, &#39;u2&#39;, &#39;snapshot&#39;}.
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation path search completed in 0.001s.
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation paths composed in 0.001s.
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation instructions replaced in 0.000s.
INFO:qiskit.transpiler.runningpassmanager:Pass: BasisTranslator - 4.98986 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CheckCXDirection - 0.07892 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXDirection - 0.71764 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: RemoveResetInZeroState - 0.02217 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 0.04625 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.01764 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 2.09403 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.07653 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 0.02766 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.01836 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 0.25296 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.06986 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 0.02646 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.01407 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 0.23460 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.05984 (ms)
INFO:qiskit.compiler.transpile:Total Transpile Time - 38.27548 (ms)
</pre></div></div>
</div>
</section>
<section id="Setting-up-logging-to-deal-with-parallel-execution">
<h3>Setting up logging to deal with parallel execution<a class="headerlink" href="#Setting-up-logging-to-deal-with-parallel-execution" title="Link permanente para este título">¶</a></h3>
<p>When running the transpiler with multiple circuits by default these circuits are transpiled in parallel. If you want to do this with logging enabled and be able to understand the output some additional steps are required.</p>
<p>If you were just to enable logging as above and then pass <code class="docutils literal notranslate"><span class="pre">transpile()</span></code> multiple circuits you’ll get results that are difficult to decipher. For example:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Change log level back to DEBUG</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;qiskit.transpiler&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
<span class="c1"># Transpile multiple circuits</span>
<span class="n">circuits</span> <span class="o">=</span> <span class="p">[</span><span class="n">log_circ</span><span class="p">,</span> <span class="n">log_circ</span><span class="p">]</span>
<span class="n">transpile</span><span class="p">(</span><span class="n">circuits</span><span class="p">,</span> <span class="n">backend</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:qiskit.transpiler.runningpassmanager:Pass: SetLayout - 0.01788 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: TrivialLayout - 0.14687 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: SetLayout - 0.01669 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Layout2qDistance - 0.79012 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: TrivialLayout - 0.17047 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Layout2qDistance - 0.97585 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FullAncillaAllocation - 0.22602 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: EnlargeWithAncilla - 0.09418 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FullAncillaAllocation - 0.25630 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: EnlargeWithAncilla - 0.10729 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: ApplyLayout - 0.69308 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: ApplyLayout - 0.62561 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Unroll3qOrMore - 0.02956 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Unroll3qOrMore - 0.02003 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CheckMap - 0.05436 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CheckMap - 0.04601 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: UnrollCustomDefinitions - 0.19526 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: UnrollCustomDefinitions - 0.13828 (ms)
INFO:qiskit.transpiler.passes.basis.basis_translator:Begin BasisTranslator from source basis {(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;h&#39;, 1), (&#39;cx&#39;, 2)} to target basis {&#39;cx&#39;, &#39;barrier&#39;, &#39;id&#39;, &#39;reset&#39;, &#39;u3&#39;, &#39;u1&#39;, &#39;measure&#39;, &#39;u2&#39;, &#39;snapshot&#39;}.
INFO:qiskit.transpiler.passes.basis.basis_translator:Begin BasisTranslator from source basis {(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;h&#39;, 1), (&#39;cx&#39;, 2)} to target basis {&#39;cx&#39;, &#39;barrier&#39;, &#39;id&#39;, &#39;reset&#39;, &#39;u3&#39;, &#39;u1&#39;, &#39;measure&#39;, &#39;u2&#39;, &#39;snapshot&#39;}.
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Begining basis search from frozenset({(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;h&#39;, 1), (&#39;cx&#39;, 2)}) to frozenset({&#39;reset&#39;, &#39;cx&#39;, &#39;u3&#39;, &#39;barrier&#39;, &#39;u1&#39;, &#39;measure&#39;, &#39;id&#39;, &#39;u2&#39;, &#39;snapshot&#39;}).
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Inspecting basis frozenset({(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;h&#39;, 1), (&#39;cx&#39;, 2)}).
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Begining basis search from frozenset({(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;h&#39;, 1), (&#39;cx&#39;, 2)}) to frozenset({&#39;reset&#39;, &#39;cx&#39;, &#39;u3&#39;, &#39;barrier&#39;, &#39;u1&#39;, &#39;measure&#39;, &#39;id&#39;, &#39;u2&#39;, &#39;snapshot&#39;}).
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Inspecting basis frozenset({(&#39;measure&#39;, 1), (&#39;h&#39;, 1), (&#39;cx&#39;, 2), (&#39;u3&#39;, 1)}).
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Inspecting basis frozenset({(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;h&#39;, 1), (&#39;cx&#39;, 2)}).
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Transformation path:
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Inspecting basis frozenset({(&#39;measure&#39;, 1), (&#39;h&#39;, 1), (&#39;cx&#39;, 2), (&#39;u3&#39;, 1)}).
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Transformation path:
DEBUG:qiskit.transpiler.passes.basis.basis_translator:x/1 =&gt; []
     ┌─────────────┐
q_0: ┤ U3(pi,0,pi) ├
     └─────────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:x/1 =&gt; []
     ┌─────────────┐
q_0: ┤ U3(pi,0,pi) ├
     └─────────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:h/1 =&gt; []
     ┌──────────┐
q_0: ┤ U2(0,pi) ├
     └──────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:h/1 =&gt; []
     ┌──────────┐
q_0: ┤ U2(0,pi) ├
     └──────────┘
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation path search completed in 0.015s.
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation path search completed in 0.019s.
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Composing transform step: x/1 [] =&gt;
     ┌─────────────┐
q_0: ┤ U3(pi,0,pi) ├
     └─────────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Composing transform step: x/1 [] =&gt;
     ┌─────────────┐
q_0: ┤ U3(pi,0,pi) ├
     └─────────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updating transform for mapped instr (&#39;x&#39;, 1) x, [] from
        ┌───┐
q303_0: ┤ x ├
        └───┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updated transform for mapped instr (&#39;x&#39;, 1) x, [] to
        ┌─────────────┐
q303_0: ┤ U3(pi,0,pi) ├
        └─────────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Composing transform step: h/1 [] =&gt;
     ┌──────────┐
q_0: ┤ U2(0,pi) ├
     └──────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updating transform for mapped instr (&#39;x&#39;, 1) x, [] from
        ┌───┐
q303_0: ┤ x ├
        └───┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updating transform for mapped instr (&#39;h&#39;, 1) h, [] from
        ┌───┐
q304_0: ┤ h ├
        └───┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updated transform for mapped instr (&#39;x&#39;, 1) x, [] to
        ┌─────────────┐
q303_0: ┤ U3(pi,0,pi) ├
        └─────────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updated transform for mapped instr (&#39;h&#39;, 1) h, [] to
        ┌──────────┐
q304_0: ┤ U2(0,pi) ├
        └──────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Composing transform step: h/1 [] =&gt;
     ┌──────────┐
q_0: ┤ U2(0,pi) ├
     └──────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updating transform for mapped instr (&#39;h&#39;, 1) h, [] from
        ┌───┐
q304_0: ┤ h ├
        └───┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updated transform for mapped instr (&#39;h&#39;, 1) h, [] to
        ┌──────────┐
q304_0: ┤ U2(0,pi) ├
        └──────────┘
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation paths composed in 0.025s.
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation instructions replaced in 0.000s.
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation paths composed in 0.026s.
INFO:qiskit.transpiler.runningpassmanager:Pass: BasisTranslator - 49.03197 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CheckCXDirection - 0.13423 (ms)
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation instructions replaced in 0.000s.
INFO:qiskit.transpiler.runningpassmanager:Pass: BasisTranslator - 54.11601 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXDirection - 0.91052 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: RemoveResetInZeroState - 0.04077 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CheckCXDirection - 0.15759 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXDirection - 0.79799 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 0.11158 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.04745 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: RemoveResetInZeroState - 0.04077 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 1.99819 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.08464 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 0.04339 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 0.10943 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.03314 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.03242 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 0.21958 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.07629 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 0.02503 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 2.43950 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.01597 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.12016 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 0.17095 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.05364 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 0.03505 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.01788 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 0.18024 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.07749 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 0.03338 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.01717 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 0.15736 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.07129 (ms)
INFO:qiskit.compiler.transpile:Total Transpile Time - 195.16397 (ms)
</pre></div></div>
</div>
<p>As you can see here we get log messages from all 3 circuits being transpiled together. There is no way to know which pass is part of which circuit’s transpilation. Luckily Python logging provides tools to deal with this. The simplest one is to just change the <a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.Formatter">log formatter</a> so that includes additional information so we can associate a log message with the process it came from.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(processName)-10s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">handlers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Then rerun the <code class="docutils literal notranslate"><span class="pre">transpile()</span></code> call and see the new log formatter.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">transpile</span><span class="p">(</span><span class="n">circuits</span><span class="p">,</span> <span class="n">backend</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: SetLayout - 0.01597 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: TrivialLayout - 0.17691 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: SetLayout - 0.01693 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: Layout2qDistance - 1.08218 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: TrivialLayout - 0.11516 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: Layout2qDistance - 0.69022 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: FullAncillaAllocation - 0.16642 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: EnlargeWithAncilla - 0.09775 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: FullAncillaAllocation - 0.31352 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: EnlargeWithAncilla - 0.15903 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: ApplyLayout - 0.44227 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: Unroll3qOrMore - 0.02933 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: CheckMap - 0.05007 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: ApplyLayout - 0.67401 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: UnrollCustomDefinitions - 0.12970 (ms)
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-5 - INFO: Begin BasisTranslator from source basis {(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;h&#39;, 1), (&#39;cx&#39;, 2)} to target basis {&#39;cx&#39;, &#39;barrier&#39;, &#39;id&#39;, &#39;reset&#39;, &#39;u3&#39;, &#39;u1&#39;, &#39;measure&#39;, &#39;u2&#39;, &#39;snapshot&#39;}.
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: Unroll3qOrMore - 0.02599 (ms)
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-5 - DEBUG: Begining basis search from frozenset({(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;h&#39;, 1), (&#39;cx&#39;, 2)}) to frozenset({&#39;reset&#39;, &#39;cx&#39;, &#39;u3&#39;, &#39;barrier&#39;, &#39;u1&#39;, &#39;measure&#39;, &#39;id&#39;, &#39;u2&#39;, &#39;snapshot&#39;}).
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: CheckMap - 0.04196 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: UnrollCustomDefinitions - 0.20337 (ms)
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-6 - INFO: Begin BasisTranslator from source basis {(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;h&#39;, 1), (&#39;cx&#39;, 2)} to target basis {&#39;cx&#39;, &#39;barrier&#39;, &#39;id&#39;, &#39;reset&#39;, &#39;u3&#39;, &#39;u1&#39;, &#39;measure&#39;, &#39;u2&#39;, &#39;snapshot&#39;}.
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-5 - DEBUG: Inspecting basis frozenset({(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;h&#39;, 1), (&#39;cx&#39;, 2)}).
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-6 - DEBUG: Begining basis search from frozenset({(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;h&#39;, 1), (&#39;cx&#39;, 2)}) to frozenset({&#39;reset&#39;, &#39;cx&#39;, &#39;u3&#39;, &#39;barrier&#39;, &#39;u1&#39;, &#39;measure&#39;, &#39;id&#39;, &#39;u2&#39;, &#39;snapshot&#39;}).
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-5 - DEBUG: Inspecting basis frozenset({(&#39;measure&#39;, 1), (&#39;h&#39;, 1), (&#39;cx&#39;, 2), (&#39;u3&#39;, 1)}).
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-6 - DEBUG: Inspecting basis frozenset({(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;h&#39;, 1), (&#39;cx&#39;, 2)}).
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-6 - DEBUG: Inspecting basis frozenset({(&#39;measure&#39;, 1), (&#39;h&#39;, 1), (&#39;cx&#39;, 2), (&#39;u3&#39;, 1)}).
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-5 - DEBUG: Transformation path:
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-6 - DEBUG: Transformation path:
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-5 - DEBUG: x/1 =&gt; []
     ┌─────────────┐
q_0: ┤ U3(pi,0,pi) ├
     └─────────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-6 - DEBUG: x/1 =&gt; []
     ┌─────────────┐
q_0: ┤ U3(pi,0,pi) ├
     └─────────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-5 - DEBUG: h/1 =&gt; []
     ┌──────────┐
q_0: ┤ U2(0,pi) ├
     └──────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-6 - DEBUG: h/1 =&gt; []
     ┌──────────┐
q_0: ┤ U2(0,pi) ├
     └──────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-5 - INFO: Basis translation path search completed in 0.018s.
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-6 - INFO: Basis translation path search completed in 0.014s.
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-6 - DEBUG: Composing transform step: x/1 [] =&gt;
     ┌─────────────┐
q_0: ┤ U3(pi,0,pi) ├
     └─────────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-5 - DEBUG: Composing transform step: x/1 [] =&gt;
     ┌─────────────┐
q_0: ┤ U3(pi,0,pi) ├
     └─────────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-5 - DEBUG: Updating transform for mapped instr (&#39;x&#39;, 1) x, [] from
        ┌───┐
q303_0: ┤ x ├
        └───┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-6 - DEBUG: Updating transform for mapped instr (&#39;x&#39;, 1) x, [] from
        ┌───┐
q303_0: ┤ x ├
        └───┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-5 - DEBUG: Updated transform for mapped instr (&#39;x&#39;, 1) x, [] to
        ┌─────────────┐
q303_0: ┤ U3(pi,0,pi) ├
        └─────────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-6 - DEBUG: Updated transform for mapped instr (&#39;x&#39;, 1) x, [] to
        ┌─────────────┐
q303_0: ┤ U3(pi,0,pi) ├
        └─────────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-5 - DEBUG: Composing transform step: h/1 [] =&gt;
     ┌──────────┐
q_0: ┤ U2(0,pi) ├
     └──────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-6 - DEBUG: Composing transform step: h/1 [] =&gt;
     ┌──────────┐
q_0: ┤ U2(0,pi) ├
     └──────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-5 - DEBUG: Updating transform for mapped instr (&#39;h&#39;, 1) h, [] from
        ┌───┐
q304_0: ┤ h ├
        └───┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-6 - DEBUG: Updating transform for mapped instr (&#39;h&#39;, 1) h, [] from
        ┌───┐
q304_0: ┤ h ├
        └───┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-5 - DEBUG: Updated transform for mapped instr (&#39;h&#39;, 1) h, [] to
        ┌──────────┐
q304_0: ┤ U2(0,pi) ├
        └──────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-6 - DEBUG: Updated transform for mapped instr (&#39;h&#39;, 1) h, [] to
        ┌──────────┐
q304_0: ┤ U2(0,pi) ├
        └──────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-6 - INFO: Basis translation paths composed in 0.020s.
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-5 - INFO: Basis translation paths composed in 0.020s.
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-5 - INFO: Basis translation instructions replaced in 0.000s.
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-6 - INFO: Basis translation instructions replaced in 0.000s.
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: BasisTranslator - 40.80915 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: BasisTranslator - 45.52960 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: CheckCXDirection - 0.11969 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: CheckCXDirection - 0.13542 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: CXDirection - 0.81277 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: CXDirection - 0.93150 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: RemoveResetInZeroState - 0.03934 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: RemoveResetInZeroState - 0.04005 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: Depth - 0.12755 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: Depth - 0.09656 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: FixedPoint - 0.03791 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: FixedPoint - 0.04053 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: Optimize1qGates - 2.46310 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: CXCancellation - 0.13208 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: Depth - 0.03552 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: FixedPoint - 0.02217 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: Optimize1qGates - 2.03133 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: CXCancellation - 0.14567 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: Optimize1qGates - 0.18024 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: CXCancellation - 0.07057 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: Depth - 0.04125 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: FixedPoint - 0.02265 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: Depth - 0.03672 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: Optimize1qGates - 0.31304 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: FixedPoint - 0.01884 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-6 - INFO: Pass: CXCancellation - 0.06986 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: Optimize1qGates - 0.17571 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: CXCancellation - 0.19479 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: Depth - 0.04315 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: FixedPoint - 0.02480 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: Optimize1qGates - 0.43654 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-5 - INFO: Pass: CXCancellation - 0.05555 (ms)
qiskit.compiler.transpile - MainProcess - INFO: Total Transpile Time - 172.73402 (ms)
</pre></div></div>
</div>
<p>Now the format for the log messages has been changed and it includes a process name for each of the transpilation processes so it’s at least clear which log messages go together.</p>
<p>There are many different options for how you can configure, this example is pretty limited. Refer to the documentation for more examples and options to build more sophisticated use cases that suit your specific use case or preferences.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">qiskit.tools.jupyter</span>
<span class="o">%</span><span class="k">qiskit_version_table</span>
<span class="o">%</span><span class="k">qiskit_copyright</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<h3>Version Information</h3><table><tr><th>Qiskit Software</th><th>Version</th></tr><tr><td>Qiskit</td><td>0.20.0</td></tr><tr><td>Terra</td><td>0.15.1</td></tr><tr><td>Aer</td><td>0.6.1</td></tr><tr><td>Ignis</td><td>0.4.0</td></tr><tr><td>Aqua</td><td>0.7.5</td></tr><tr><td>IBM Q Provider</td><td>0.8.0</td></tr><tr><th>System information</th></tr><tr><td>Python</td><td>3.8.5 | packaged by conda-forge | (default, Jul 31 2020, 02:39:48)
[GCC 7.5.0]</td></tr><tr><td>OS</td><td>Linux</td></tr><tr><td>CPUs</td><td>4</td></tr><tr><td>Memory (Gb)</td><td>30.82091522216797</td></tr><tr><td colspan='2'>Tue Sep 08 13:39:41 2020 EDT</td></tr></table></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div style='width: 100%; background-color:#d5d9e0;padding-left: 10px; padding-bottom: 10px; padding-right: 10px; padding-top: 5px'><h3>This code is a part of Qiskit</h3><p>&copy; Copyright IBM 2017, 2020.</p><p>This code is licensed under the Apache License, Version 2.0. You may<br>obtain a copy of this license in the LICENSE.txt file in the root directory<br> of this source tree or at http://www.apache.org/licenses/LICENSE-2.0.<p>Any modifications or derivative works of this code must retain this<br>copyright notice, and modified files need to carry a notice indicating<br>that they have been altered from the originals.</p></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</section>
</section>
</section>


             </article>
             
            </div>
            <footer>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, Qiskit Development Team.
      Última actualização em 2021/07/06.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              <ul>
<li><a class="reference internal" href="#">Transpiler Passes and Pass Manager</a><ul>
<li><a class="reference internal" href="#Introduction">Introduction</a></li>
<li><a class="reference internal" href="#PassManager-object">PassManager object</a></li>
<li><a class="reference internal" href="#Different-Variants-of-the-Same-Pass">Different Variants of the Same Pass</a></li>
<li><a class="reference internal" href="#Preset-Pass-Managers">Preset Pass Managers</a></li>
<li><a class="reference internal" href="#Introducing-the-DAG">Introducing the DAG</a></li>
<li><a class="reference internal" href="#Implementing-a-BasicMapper-Pass">Implementing a BasicMapper Pass</a></li>
<li><a class="reference internal" href="#Transpiler-Logging">Transpiler Logging</a><ul>
<li><a class="reference internal" href="#Configuring-Python-Standard-Library-Logging">Configuring Python Standard Library Logging</a></li>
<li><a class="reference internal" href="#Adjusting-the-log-level-for-the-transpiler">Adjusting the log level for the transpiler</a></li>
<li><a class="reference internal" href="#Setting-up-logging-to-deal-with-parallel-execution">Setting up logging to deal with parallel execution</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </div>
          </div>
        </div>
      </section>
    </div>

  

     
       <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
         <script src="../../_static/jquery.js"></script>
         <script src="../../_static/underscore.js"></script>
         <script src="../../_static/doctools.js"></script>
         <script src="../../_static/language_data.js"></script>
         <script src="../../_static/thebelab-helper.js"></script>
         <script src="../../_static/translations.js"></script>
         <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
         <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^0.21.0-alpha.0/dist/embed-amd.js"></script>
         <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
         <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
         <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
     

  

  <script type="text/javascript" src="../../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../../_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

  <div>
    <br>
  </div>

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://qiskit.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="../../getting_started.html">Getting Started</a>
          </li>
          <li>
            <a href="../../tutorials.html">Tutorials</a>
          </li>
          <li>
            <a href="https://qiskit.org/documentation/partners/">Providers</a>
          </li>
          <br>
          <li class="resources-mobile-menu-title">
            Applications
          </li>
          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://qiskit.org/documentation/machine-learning/">Machine learning</a>
            </li>

            <li>
              <a href="https://qiskit.org/documentation/nature/">Nature</a>
            </li>

            <li>
              <a href="https://qiskit.org/documentation/finance/">Finance</a>
            </li>

            <li>
              <a href="https://qiskit.org/documentation/optimization/">Optimization</a>
            </li>
          </ul>

          <br>

          <li class="resources-mobile-menu-title">
            Resources
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://qiskit.slack.com">Slack support</a>
            </li>
          </ul>
          <br>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>